<!doctype html>
<html lang="lv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>CADET.LV Interaktīvais kompass © Jānis Eglis</title>

  <!-- Trešo pušu CSS vispirms -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!-- Tavs CSS pēc tam, lai var pārrakstīt -->
  <link rel="stylesheet" href="style.css">

  <!-- (pēc vajadzības) vieta JS ģenerētiem stiliem -->
  <style id="runtime-styles"></style>

  <!-- Leaflet JS pirms tava koda -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- TAVS kods – bez type="module" -->
  <script defer src="app.js"></script>
</head>
<body>


<!-- PRELOADER (sākuma pārklājums) -->
<div id="app-preloader" role="status" aria-live="polite" aria-label="Ielādējam…">
  <div class="preloader-inner">
    <img class="brand" src="https://site-710050.mozfiles.com/files/710050/medium/CADET_TRANSP_.png?1542126381" alt="CADET.LV" />
	<div class="preloader-about" aria-label="Par projektu">
  	<span>CADET.LV</span>
 	<span>INTERAKTĪVAIS KOMPASS</span>
  	<span>© JĀNIS EGLIS</span>
	</div>
	<div class="spinner" aria-hidden="true"></div>
    <div class="progress"><span style="width:0%"></span></div>
    <p class="msg">Ielādējam… 0%</p>
    <button id="preloaderSkip" class="skip" type="button">Turpināt</button>
  </div>
</div>


	
   	<!-- Brīdinājuma pārklājums viedtālruņiem -->
							<div id="mobile-warning" style="display: none;">
								<div class="warning-content">
									<p>Lūdzu, izmantojiet lielāku ekrānu šīs lietotnes darbībai.</p>
									<img style="width:100px; height:auto;" src="https://site-710050.mozfiles.com/files/710050/fullscreen-11-xxl.png" alt="Nepietiekams ekrāna izmērs" style="width: 80%; margin-top: 20px;">
									<p>INTERAKTĪVAIS KOMPASS</p>
									<p style="color: rgba(255, 255, 255, 0.5);">CADET.LV | © Jānis Eglis</p>
								</div>
							</div>

							<!-- Pārklājums mobilajām ierīcēm vertikālā režīmā -->
							<div id="orientation-overlay">
								<h1><img src="https://site-710050.mozfiles.com/files/710050/medium/Rotate_V5-2.jpg" alt="Pagrieziet ierīci"></h1>
							</div>						

							<div id="fullscreenMessage" class="fs-message-hidden">
								<div class="arrow"></div>
								<p id="fullscreenMessagetext">
									<span class="highlight-title">Lūdzu, iestatiet logu pilnā izmērā, lai sāktu darbu.</span>
									<br>
									Varat izmantot F11, lai logu darbinātu pilnekrāna režīmā vai palielināt logu līdz ekrāna izmēram spiežot simbolu "𖧵" pārlūka galvenē.<br><br>
									<a href="https://cadet.lv" target="_blank" style="color: white; font-weight: bold;">CADET.LV</a>
									<br>
									<span style="color: " class="copyright">CADET.LV | © Jānis Eglis</span>
								</p>
							</div> 
							
							<div id="touchscreenPopup"></div>
							
							<div id="fullscreenPopup"></div>

													
							<div id="canvasContainer" 
								 style="position: fixed; 
										width: 1920px; 
										height: 1080px;">

							 


<div id="canvasContainer" style="position:fixed;width:1920px;height:1080px;">
  <!-- 1) Vienīgā kanva (lokālajai bildes kartei) -->
  <canvas id="mapCanvas" width="1920" height="1080" style="display:block;width:100%;height:100%;"></canvas>

  <!-- 2) Tiešsaistes karte + tumšošanas pārklājums -->
  <div id="onlineMap">
    <div id="onlineMapDim"></div> <!-- tumšošanas pārklājums, pirmais bērns -->
    <!-- te Leaflet iemetīs karti -->
  </div>
</div>
                



								
							  <!-- Jaunais <img>, kur glabāt augšupielādēto attēlu -->
							  <img id="uploadedImg" 
								   src="" 
								   alt="Augšupielādētais attēls"
								   style="
									 position: absolute;
									 top: 0;
									 left: 0;
									 display: none; /* Slēpts līdz augšupielādē attēlu */
									 cursor: move;  /* Ja vēlaties, var padarīt arī pārvietojamu */
									  
									 ">
									 

							  <!-- MapResize rokturis -->
								<div id="resizeHandle">
									<img src="https://site-710050.mozfiles.com/files/710050/resize_map__1_.png" alt="Resize">
								</div>
							</div>

																			
							<!-- MapResize Papildu elements attēlam -->
							<img id="newUploadedImg" 
								 style="
								   position: absolute; 
								   top: 50px; 
								   left: 50px; 
								   display: none;
								   cursor: move;
								   
								 " 
								 alt="Augšupielādētais attēls">

							<!-- MapResize rokturis -->
							<div id="newResizeHandle"
								 style="
								   display: none;
								   width: 30px;
								   height: 30px;
								   position: absolute;
								   cursor: se-resize;
								   z-index: 9;
								 ">
							</div>						
							

							<div class="dropdown-container">
							        <div class="top-bar">
							            <span class="dropdown-toggle" id="toggleInstruction">Lietotāja ceļvedis ⬇</span>
							            <span class="dropdown-toggle" id="toggleMaterials">Mācību materiāli ⬇</span>
							        </div>
							
							        <div class="dropdown-menu" id="dropdownInstruction">
							            <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page/">DARBAM AR DATORU</a>
							            <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page-1/">DARBAM AR SKĀRIENJŪTĪGĀM IERĪCĒM</a>
										<a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page-2/">LIETOŠANAS NOTEIKUMI</a>
							           <iframe id="instructionFrame" name="contentFrame" style="width: 100%; height: 85vh; border: none;"></iframe>  
							            
							        </div>
							
							        <div class="dropdown-menu" id="dropdownMaterials">
							        <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/topografiskas-kartes/" class="dropdown-link">TOPOGRĀFISKĀS KARTES</a>
							        <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/merogs-un-attalumi/" class="dropdown-link">MĒROGS UN ATTĀLUMI</a>
							        <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/apzimejumi-kartes/" class="dropdown-link">APZĪMĒJUMI KARTĒS</a>
							        <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/direkcijas-lenkis-un-azimuts/" class="dropdown-link">DIREKCIJAS LEŅĶIS UN AZIMUTS</a>
							        <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/koordinates/" class="dropdown-link">KOORDINĀTES</a>
							        <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/citi/" class="dropdown-link">CITI</a>
									
									 
							 <iframe id="contentFrame" name="contentFrame" style="width: 100%; height: 75vh; border: none;"></iframe>
							        </div>
									 			
														
							</div>	
														

							 <!-- Izvēlne konteineram -->
							 <!-- Izvēlne konteineram LABAJĀ pusē -->
							<div class="position-selector-container">
								<div class="position-selector">
									<button class="toggle-selector">❯</button>
									<select id="positionSelect">
										<option disabled selected>Izvēlies pogas novietojumu:</option>
										<option value="bottom">Apakšā (noklusējums)</option>
										<option value="right">Labajā pusē</option>
										<option value="left">Kreisajā pusē</option>
									</select>
								</div>
							</div>

							<!-- Izvēlne konteineram KREISAJĀ pusē -->
							<div class="position-selector-container-left">
								<div class="position-selector-left">
									<button class="toggle-selector-left">❯</button>
									<select id="positionSelectLeft">
										<option disabled selected>Izvēlies pogas novietojumu:</option>
										<option value="bottom">Apakšā (noklusējums)</option>
										<option value="right">Labajā pusē</option>
										<option value="left">Kreisajā pusē</option>
									</select>
								</div>
							</div>

							<!-- Popup grid view -->
							<div id="popupMenu" style="display: none;">
								<h3>Izvēlieties noteikšanas metodi</h3>
								<div class="button-row">
									<button id="popupOption1" class="popup-button">
										<img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_1_1.png" alt="Funkcija 1">
									</button>
									<button id="popupOption2" class="popup-button">
										<img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_2.png" alt="Funkcija 2">
									</button>
								</div>
								<button id="popupClose" class="popup-close">Aizvērt</button>
							</div>

							<!-- Pogas konteiners -->
							<div class="button-container bottom" id="buttonContainer">
								<button id="resetMap">
									<img src="https://site-710050.mozfiles.com/files/710050/RESER_MAPS_Cropped-Photoroom.png" alt="Reset Map">
								</button>
								<button id="uploadMap">
									<img src="https://site-710050.mozfiles.com/files/710050/UPLOAD_MAPS_Cropped-Photoroom.png" alt="Upload Map">
								</button>
                <button id="toggleOnlineMap" data-title="Tiešsaistes karte" aria-label="Tiešsaistes karte">
                  <img alt="Tiešsaistes karte"
                       src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='3,6 9,3 15,6 21,3 21,18 15,21 9,18 3,21 3,6'/%3E%3Cline x1='9' y1='3' x2='9' y2='18'/%3E%3Cline x1='15' y1='6' x2='15' y2='21'/%3E%3C/svg%3E">
                </button>
								<button id="resetCompass">
									<img src="https://site-710050.mozfiles.com/files/710050/RESET_COMPASS_Cropped-Photoroom.png" alt="Reset Compass">
								</button>
								<button class="touch-only" id="toggleRotationMode">
									<img src="https://site-710050.mozfiles.com/files/710050/ROTATE_COMPASS_BASE__1__Cropped-Photoroom.png" alt="Toggle Rotation">
								</button>			
								<button class="touch-only" id="lockRotationMode">
									<img src="https://site-710050.mozfiles.com/files/710050/COMPASS_ROTATE_LOCK_OPEN__1__Cropped-Photoroom.png" alt="Lock Rotation">
								</button>	
								<button id="rotateCompass90">
									<img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_Cropped-Photoroom.png" alt="Rotate 90° and Lock">
								</button>
								<button id="toggleFullscreen">
								<img id="fullscreenIcon" src="https://site-710050.mozfiles.com/files/710050/icon_fullscreen_enter.png" alt="Pilnkrāna Ieslēgšana">
								</button>
							</div>
							
							<div id="about">
							<a href="javascript:void(0);" class="qrLink" onclick="toggleIframeQR(event)">KOPLIETOT</a>
								<span class="abouttext">CADET.LV</span>
								<span class="abouttext" >INTERAKTĪVAIS KOMPASS</span> 
								<span class="abouttext">© JĀNIS EGLIS</span>
								<a href="javascript:void(0);" class="aboutlink" onclick="toggleIframeAbout(event)">ATSAUKSME / ZIŅOT</a>
							</div>
							
							
							<!-- IFRAME KONTEINERS (SĀKOTNĒJI PASLĒPTS) -->
							<div id="iframeContainerAbout">
								<iframe id="feedbackIframe" src="https://docs.google.com/forms/d/e/1FAIpQLSdflr72km2RpI7hdn05AmH5gRZgBk69y7UCz0sCJ37ujOyQ3Q/viewform?embedded=true" frameborder="0"></iframe>
								<button id="closeIframeAbout" onclick="toggleIframeAbout(event)">✖</button>
							</div>						
							
							<!-- QR kods konteineris (SĀKOTNĒJI PASLĒPTS) -->
							<div id="iframeContainerQR">
								<div id="qrCodeContent">
									<p class="qrTitle">KOPLIETOŠANAS QR KODS AUDITORIJAI</p>
									<img id="qrCodeImage" src="https://site-710050.mozfiles.com/files/710050/DOC_ERROR_AR_KRUSTU_PNG-1.png" alt="QR Code">
								</div>
								<button id="closeIframeQR" onclick="toggleIframeQR(event)">✖</button>
							</div>

							<div id="compassContainer">
								<div id="compassScaleContainer">
									<div id="compassInner">
										<img id="compassBase" src="https://site-710050.mozfiles.com/files/710050/VIRTUALAIS_KOMPASS_PAMATNE_PV6.png" alt="Compass Base">
									</div>  
									<div id="compassScaleInner">
										<img id="compassScale" src="https://site-710050.mozfiles.com/files/710050/KOMPASA_SKALA_CADET_LV_PV6_V3.png" alt="Compass Scale">
									</div>      
									<img id="compassNeedle" src="https://site-710050.mozfiles.com/files/710050/VIRTUALAIS_KOMPASS_ADATA_CADET_LV_PV4.png" alt="Compass Needle">  
								</div>
							</div>
















<script>
/* ====== DevTool: kompakts panelis ar ritināšanu un atskaites kopēšanu ====== */
(function(){
  // ─ helpers
  const fmtTime = d => new Date(d).toLocaleTimeString();
  const toText  = v => {
    try{
      if (typeof v === 'string') return v;
      if (v instanceof Error) return (v.stack || (v.name+': '+v.message));
      return JSON.stringify(v, null, 2);
    }catch(e){ return String(v); }
  };

  // ─ UI
  const toggle = document.createElement('button');
  toggle.id = 'devtool-toggle';
  toggle.type = 'button';
  toggle.title = 'Atvērt DevTool';
  toggle.textContent = '🛠';
  document.body.appendChild(toggle);

  const root = document.createElement('div');
  root.id = 'devtool';
  root.innerHTML = `
    <div class="bar">
      <strong>DevTool</strong>
      <span class="spacer"></span>
      <button data-act="clear">Notīrīt</button>
      <button data-act="min">Min</button>
      <button data-act="close">✖</button>
    </div>
    <div class="body" id="devtool-body"></div>
    <div class="footer">
      <button id="dt-copy">Kopēt atskaiti</button>
      <button id="dt-dl">Lejupielādēt .txt</button>
      <label title="Paturēt ritinājumu apakšā"><input type="checkbox" id="dt-lock" checked> Scroll-lock</label>
      <label title="Pauzēt jaunu rindu pievienošanu"><input type="checkbox" id="dt-pause"> Pauze</label>
    </div>`;
  document.body.appendChild(root);

  const body  = root.querySelector('#devtool-body');
  const lock  = root.querySelector('#dt-lock');
  const pause = root.querySelector('#dt-pause');

  // ─ atvēršana/aizvēršana
  toggle.addEventListener('click', ()=> root.classList.toggle('open'));
  root.querySelector('[data-act="close"]').addEventListener('click', ()=> root.classList.remove('open'));
  root.querySelector('[data-act="min"]').addEventListener('click', ()=>{
    // samazinām līdz šaurai joslai; klikšķis uz joslas atkal atver
    const h = root.style.height;
    root.style.height = (h && parseInt(h) < 120) ? '' : '38px';
  });

  // notīrīt
  root.querySelector('[data-act="clear"]').addEventListener('click', ()=> { body.textContent = ''; });

  // ─ drag and drop pārvietošana ar virsraksta joslu
  (function enableDrag(){
    const bar = root.querySelector('.bar');
    let dragging = false, sx=0, sy=0, startRight=0, startBottom=0;
    const onDown = e => {
      dragging = true;
      const ev = e.touches ? e.touches[0] : e;
      sx = ev.clientX; sy = ev.clientY;
      const cs = getComputedStyle(root);
      startRight  = parseFloat(cs.right);
      startBottom = parseFloat(cs.bottom);
      e.preventDefault();
    };
    const onMove = e => {
      if(!dragging) return;
      const ev = e.touches ? e.touches[0] : e;
      const dx = ev.clientX - sx;
      const dy = ev.clientY - sy;
      root.style.right  = Math.max(4, startRight - dx) + 'px';
      root.style.bottom = Math.max(4, startBottom - dy) + 'px';
    };
    const onUp = ()=> dragging=false;

    bar.addEventListener('mousedown', onDown);
    bar.addEventListener('touchstart', onDown, {passive:false});
    window.addEventListener('mousemove', onMove);
    window.addEventListener('touchmove', onMove, {passive:false});
    window.addEventListener('mouseup', onUp);
    window.addEventListener('touchend', onUp);
  })();

  // ─ log buffer + pievienošana
  function appendLine(txt){
    if (pause.checked) return;
    const atBottom = lock.checked && (body.scrollTop + body.clientHeight >= body.scrollHeight - 4);
    const line = document.createElement('div');
    line.textContent = txt;
    body.appendChild(line);
    if (atBottom) body.scrollTop = body.scrollHeight;
  }
  function log(){ appendLine(`[${fmtTime(Date.now())}] ` + Array.from(arguments).map(toText).join(' ')); }

  // ─ Report (savāc satura stāvokli)
  function makeReport(){
    const lines = [];
    const ls = k => (localStorage.getItem(k) ?? '—');
    const safe = id => {
      const el = document.getElementById(id);
      if(!el) return '—';
      const r = el.getBoundingClientRect();
      return `${id}: ${Math.round(r.width)}×${Math.round(r.height)} (display:${getComputedStyle(el).display})`;
    };

    lines.push('=== ATSTĀVOKĽA ATSKAITE =========================');
    lines.push('URL: ' + location.href);
    lines.push('Laiks: ' + new Date().toString());
    lines.push('User-Agent: ' + navigator.userAgent);
    lines.push('');
    lines.push('Viewport: ' + window.innerWidth + '×' + window.innerHeight);
    lines.push('visualViewport: ' + (window.visualViewport ? `${Math.round(window.visualViewport.width)}×${Math.round(window.visualViewport.height)}` : 'nav'));
    lines.push('');
    lines.push('localStorage:');
    lines.push('  onlineMapActive = ' + ls('onlineMapActive'));
    lines.push('  buttonPosition  = ' + ls('buttonPosition'));
    lines.push('  mapDarken       = ' + ls('mapDarken'));
    lines.push('');
    lines.push('Elementi:');
    lines.push('  ' + safe('buttonContainer'));
    lines.push('  ' + safe('onlineMap'));
    lines.push('  ' + safe('mapCanvas'));
    lines.push('  ' + safe('about'));
    lines.push('');

    // mēģinām paņemt Leaflet karti, ja pieejama
    try{
      const map = window.__getMap ? window.__getMap() : null;
      if (map && map.getCenter){
        const c = map.getCenter();
        lines.push('Karte:');
        lines.push('  zoom=' + map.getZoom());
        lines.push(`  center= ${c.lat.toFixed(6)}, ${c.lng.toFixed(6)}`);
        lines.push('  size= ' + map.getSize().x + '×' + map.getSize().y);
        lines.push('');
      } else {
        lines.push('Karte: nav pieejama (__getMap nav vai initMap vēl nav pabeigts).');
        lines.push('');
      }
    }catch(e){
      lines.push('Karte: kļūda, lasot stāvokli: ' + (e && e.message ? e.message : e));
      lines.push('');
    }

    lines.push('Pēdējās redzamās rindas no loga:');
    // paņemam redzamo loga saturu
    const items = body.querySelectorAll('div');
    const n = items.length;
    const tail = Math.max(0, n - 80); // max 80 rindas
    for (let i = tail; i < n; i++){
      lines.push('  ' + items[i].textContent);
    }
    lines.push('====================================================');
    return lines.join('\n');
  }

  // ─ Kopēt / Lejupielādēt
  root.querySelector('#dt-copy').addEventListener('click', async ()=>{
    const txt = makeReport();
    try{
      if (navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(txt);
        log('✅ Atskaites teksts nokopēts starpliktuvē.');
      }else{
        const ta = document.createElement('textarea');
        ta.value = txt; ta.style.position='fixed'; ta.style.opacity='0';
        document.body.appendChild(ta); ta.focus(); ta.select();
        document.execCommand('copy'); document.body.removeChild(ta);
        log('✅ Atskaites teksts nokopēts (rezerves metode).');
      }
    }catch(e){ log('❌ Neizdevās nokopēt: ' + e); }
  });

  root.querySelector('#dt-dl').addEventListener('click', ()=>{
    const blob = new Blob([makeReport()], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'atskaite.txt';
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
    log('⬇️ Sagatavota atskaite .txt formātā.');
  });

  // ─ Pieslēdzamies Leaflet kartei (kad gatava)
  (function waitMapAndHook(){
    let tries = 0, maxTries = 40; // ~20s
    const t = setInterval(()=>{
      tries++;
      try{
        if (window.__getMap){
          const map = window.__getMap();
          if (map && map.on){
            clearInterval(t);
            // būtiskie notikumi
            map.on('load',      ()=> log('Leaflet: load'));
            map.on('moveend',   ()=> { const c=map.getCenter(); log(`Leaflet: moveend zoom=${map.getZoom()} center=${c.lat.toFixed(6)},${c.lng.toFixed(6)}`); });
            map.on('zoomend',   ()=> { const c=map.getCenter(); log(`Leaflet: zoomend zoom=${map.getZoom()} center=${c.lat.toFixed(6)},${c.lng.toFixed(6)}`); });
            map.on('layeradd',  e => log('Leaflet: layeradd', (e.layer && e.layer._leaflet_id) || ''));
            map.on('layerremove',e=> log('Leaflet: layerremove', (e.layer && e.layer._leaflet_id) || ''));
            log('🔗 DevTool pieslēdzās Leaflet kartei.');
          }
        }
      }catch(e){ /* klusējam */ }
      if (tries >= maxTries) clearInterval(t);
    }, 500);
  })();

  // ─ pārtveram globālās kļūdas uz logu (palīdz atskaitē)
  window.addEventListener('error', e => {
    log('❗ Kļūda:', e.message, '@', e.filename+':'+e.lineno+':'+e.colno);
  });
  window.addEventListener('unhandledrejection', e => {
    log('❗ Neapstrādāts solījums:', toText(e.reason));
  });

  // ─ publiska API “ja vajag”
  window.__devtool = {
    open(){ root.classList.add('open'); },
    close(){ root.classList.remove('open'); },
    log,
    report: makeReport
  };

  // sākuma ziņa
  log('DevTool gatavs. Noklikšķini 🛠, lai atvērtu.');
})();
</script>
















	
	
</body>
</html>
