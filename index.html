<!doctype html>
<html lang="lv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
<title>CADET.LV Interaktƒ´vais kompass ¬© JƒÅnis Eglis</title>
<link rel="icon" type="image/png" href="https://site-710050.mozfiles.com/files/710050/CADET_ICON.PNG">
<style>
  :root{
    --bg:#0b0b0b; --ink:#fff; --muted:#bfbfbf;
    --accent:#d0021b; --accent-2:#5b1010; --accent-3:#bb0101;
    --glass:rgba(0,0,0,.72); --glass-2:rgba(0,0,0,.85);
    --card:rgba(20,20,20,.9); --shadow:0 10px 30px rgba(0,0,0,.35);
    --ring:0 0 0 2px rgba(208,2,27,.55);
    --vh:1vh;
  }

  html,body{height:100%;margin:0;background:#111;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  *{box-sizing:border-box}

  /* FONA KANVA */
  #canvasContainer{
    position:fixed; inset:0; overflow:hidden; touch-action:none;
    background:#181818 url('https://site-710050.mozfiles.com/files/710050/medium/CADET_TRANSP_.png?1542126381') no-repeat center / 70% 30%;
  }
  #mapCanvas{display:block; width:100%; height:100%}

  /* PILNEKRƒÄNA PADOMS */
  #fullscreenMessage{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    visibility:hidden; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
    z-index:15; background:rgba(0,0,0,.4);
  }
  #fullscreenMessage.visible{visibility:visible}
  #fullscreenMessagetext{
    background:rgba(255,0,0,.5); border:2px solid red; color:#fff; font-weight:700;
    padding:20px; width:min(700px,90vw); border-radius:12px; text-align:center; box-shadow:var(--shadow)
  }
  .highlight-title{display:block; font-size:clamp(18px,2.5vw,28px); margin-bottom:6px; text-shadow:0 2px 8px rgba(0,0,0,.5)}

  /* BULTA */
  .arrow{
    position:fixed; top:20px; right:56px; z-index:16;
    width:0; height:0; border-left:2.5vh solid transparent; border-right:2.5vh solid transparent; border-bottom:5vh solid red;
    animation:bounce 1.6s ease-in-out infinite;
  }
  .arrow::before{
    content:"ñßµ"; position:absolute; color:#fff; font-size:2.5vh; top:8px; right:-8px; transform:scaleX(1.5)
  }
  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}

  /* POPUP INFO */
  #touchscreenPopup,#fullscreenPopup{
    position:fixed; bottom:28px; right:12px; display:none; z-index:9999;
    padding:12px 14px; font-weight:700; border-radius:10px; box-shadow:var(--shadow)
  }
  .popup-success{background:#28a745} .popup-error{background:#dc3545}

  /* KOMPASS */
  #compassContainer{
    position:absolute; width:25vw; height:14vw; min-width:240px; min-height:135px;
    z-index:3; transform-origin:center; image-rendering:crisp-edges; pointer-events:none;
  }
  #compassScaleContainer{position:relative; width:25vw; height:14vw; transform-origin:center; pointer-events:none}
  #compassInner{position:absolute; width:14vw; height:14vw; left:41.5%; top:0%; transform:translate(-50%,-50%); transform-origin:center; image-rendering:crisp-edges}
  #compassBase{position:absolute; width:25vw; height:auto; left:13.5%; top:50%; transform:translate(-49.9%,-50.2%); display:block; pointer-events:auto; image-rendering:crisp-edges}
  #compassScaleInner{position:absolute; width:14vw; height:14vw; left:41.5%; top:0%; transform:translate(-50%,-50%) rotate(70deg); transform-origin:center; border-radius:50%}
  #compassScale{position:absolute; width:13vw; height:13vw; left:50.05%; top:50.04%; transform:translate(-50%,-50%); display:block; border-radius:50%; pointer-events:auto; image-rendering:crisp-edges}
  #compassNeedle{position:absolute; width:.65vw; min-width:6px; left:69.5%; top:50%; transform:translate(-50%,-50%); transform-origin:center; opacity:.85; animation:rotateCompassNeedle 50s linear infinite}
  @keyframes rotateCompassNeedle{from{transform:translate(-50%,-50%) rotate(0)}to{transform:translate(-50%,-50%) rotate(360deg)}}

  .with-transition{transition:left .20s ease, top .20s ease, transform .40s ease}

  /* POGAS */
  .button-container{
    position:fixed; inset-inline:0; display:flex; gap:clamp(8px,1.2vw,16px); justify-content:center; z-index:10; pointer-events:none;
    transition:transform .2s ease, bottom .2s ease, top .2s ease;
  }
  .button-container.bottom{bottom:calc(var(--vh) * 5)}
  .button-container.left{left:2%; top:50%; transform:translateY(-50%); flex-direction:column}
  .button-container.right{right:2%; top:50%; transform:translateY(-50%); flex-direction:column}

  .tool-btn{
    background:rgba(91,16,16,.82); border:none; border-radius:50%; box-shadow:var(--shadow);
    width:clamp(46px,6vw,72px); height:clamp(46px,6vw,72px); display:flex; align-items:center; justify-content:center;
    cursor:pointer; pointer-events:auto; transition:transform .12s ease, box-shadow .12s ease; outline-offset:2px
  }
  .tool-btn:focus-visible{box-shadow:var(--ring)}
  .tool-btn:hover{transform:scale(1.05)}
  .tool-btn img{width:92%; height:92%; object-fit:contain; display:block}
  .tool-btn.active{background:var(--accent-3)}

  /* POZƒ™CIJAS IZVƒíLE */
  .position-selector-shell{position:fixed; top:15%; right:0; transform:translateY(-50%); z-index:12}
  .position-selector, .position-selector-left{
    background:var(--glass); padding:10px; width:250px; display:flex; flex-direction:column; align-items:center; position:relative;
    box-shadow:var(--shadow)
  }
  .position-selector::after,.position-selector-left::after{content:""; display:block; height:3px; background:rgba(255,0,0,.8); position:absolute; inset-inline:0; bottom:0}
  .toggle-selector,.toggle-selector-left{
    position:absolute; top:0; bottom:0; margin:auto 0; width:30px; border:none; color:#fff; cursor:pointer; font-size:14px;
    background:rgba(255,0,51,.7)
  }
  .toggle-selector{left:-30px; border-radius:10px 0 0 10px}
  .toggle-selector-left{right:-30px; border-radius:0 10px 10px 0}
  .toggle-selector:hover,.toggle-selector-left:hover{background:rgba(255,0,0,.9)}
  .hidden{transform:translateX(100%)}
  .hidden-left{transform:translateX(-100%)}
  #positionSelect,#positionSelectLeft{
    width:230px; padding:8px 10px; background:rgba(0,0,0,.5); color:#fff; border:1px solid rgba(255,255,255,.15); border-radius:8px; font-size:16px
  }
  #positionSelect option,#positionSelectLeft option{background:rgba(0,0,0,.8); color:#fff}

  /* DROP-DOWN josla + IFRAME */
  .dropdown-container{position:fixed; inset-inline:0; top:0; z-index:11}
  .top-bar{display:flex; gap:10px; justify-content:center; padding:0; background:transparent}
  .dropdown-toggle{
    width:49%; text-align:center; padding:6px 10px; border:none; cursor:pointer; color:#fff; font-weight:600;
    background:rgba(255,0,51,.7); border-radius:0 0 6px 6px; transition:filter .2s ease, transform .1s ease
  }
  .dropdown-toggle:hover{filter:brightness(1.07)}
  .dropdown-toggle.active{box-shadow:0 0 0 3px rgba(255,0,51,.3) inset}

  .dropdown-menu{
    position:fixed; left:0; top:-100%; width:100%; height:calc(100vh - 40px); padding:20px;
    display:flex; flex-wrap:wrap; align-items:center; justify-content:center; gap:12px;
    background:var(--glass-2); box-shadow:var(--shadow); visibility:hidden; transition:top .4s ease, opacity .4s ease
  }
  .dropdown-menu.visible{top:-18px; visibility:visible}
  .dropdown-link{
    display:flex; align-items:center; justify-content:center; width:min(480px,30%); min-width:220px; height:52px;
    text-decoration:none; color:#fff; font-weight:600; background:rgba(50,50,50,.8); border-radius:8px; transition:filter .2s ease
  }
  .dropdown-link:hover{filter:brightness(1.15)}
  #contentFrame,#instructionFrame{
    width:100%; height:0; border:none; display:block; margin-top:0; transition:height .3s ease, margin-top .3s ease
  }
  #contentFrame.active,#instructionFrame.active{height:75vh; margin-top:16px}

  /* ABOUT APAK≈†ƒÄ */
  #about{
    position:fixed; inset-inline:0; bottom:0; display:flex; gap:12px; justify-content:center; align-items:center;
    padding:.3vw .6vw; background:rgba(0,0,0,.8); z-index:20; color:rgba(255,255,255,.85); font-weight:600
  }
  .abouttext{font-size:15px}
  .aboutlink,.qrLink{
    position:absolute; padding:6px 10px; right:10px; top:0; width:170px; text-align:center; color:#fff;
    text-decoration:none; background:var(--accent); border-radius:6px 6px 0 0; transition:filter .2s ease
  }
  .qrLink{left:10px; right:auto; bottom:-2px; top:auto}
  .aboutlink:hover,.qrLink:hover{filter:brightness(1.1)}

  /* PELDLOGI: Atsauksmes / QR */
  .fly-panel{
    position:fixed; background:#fff; border-radius:10px; overflow:hidden; box-shadow:var(--shadow);
    display:none; z-index:9999;
  }
  #iframeContainerAbout{width:min(500px,92vw); height:min(620px,85vh); right:20px; bottom:-640px}
  #iframeContainerQR{width:300px; height:330px; left:20px; bottom:-370px; background:rgba(0,0,0,.85); color:#fff; padding:20px; text-align:center}
  #iframeContainerAbout iframe{width:100%; height:100%; border:0}
  .fly-close{
    position:absolute; top:6px; right:6px; width:28px; height:28px; border-radius:50%; border:none; background:#e11; color:#fff; cursor:pointer
  }
  .qrTitle{font-weight:800; margin:0 0 10px}
  #qrCodeImage{width:250px; height:250px}

  /* ORIENTƒÄCIJA / ‚Äúmazs ekrƒÅns‚Äù */
  #orientation-overlay,#mobile-warning{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; text-align:center; z-index:9999;
  }
  #orientation-overlay{background:#000; color:#fff; padding:24px}
  #mobile-warning{background:rgba(0,0,0,.9); color:#fff; padding:24px}

  /* ATTƒíLA RESIZE ROKTURIS */
  #resizeHandle{
    position:absolute; display:none; align-items:center; justify-content:center; width:clamp(28px,5.2vw,44px); height:clamp(28px,5.2vw,44px);
    background:rgba(255,0,0,.5); border-radius:6px; cursor:se-resize; z-index:5; border:2px solid rgba(255,255,255,.8)
  }
  #resizeHandle img{width:90%; height:90%; object-fit:contain; pointer-events:none}

  /* MAZI EKRƒÄNI */
  @media (max-width: 768px){
    .dropdown-link{width:92%}
    .position-selector-shell{top:22%}
  }
</style>
</head>
<body>
  <!-- PILNEKRƒÄNA PADOMS -->
  <div id="fullscreenMessage" aria-live="polite">
    <div class="arrow" aria-hidden="true"></div>
    <p id="fullscreenMessagetext">
      <span class="highlight-title">L≈´dzu, iestatiet logu pilnƒÅ izmƒìrƒÅ, lai sƒÅktu darbu.</span>
      Varat izmantot F11 pilnekrƒÅnam vai spiest ‚Äúñßµ‚Äù pƒÅrl≈´kƒÅ.<br><br>
      <a href="https://cadet.lv" target="_blank" rel="noopener" style="color:#fff;font-weight:700">CADET.LV</a><br>
      <span class="copyright">CADET.LV | ¬© JƒÅnis Eglis</span>
    </p>
  </div>

  <div id="touchscreenPopup"></div>
  <div id="fullscreenPopup"></div>

  <!-- KANVA UN AUG≈†UPIELƒÄDƒíTAIS ATTƒíLS -->
  <div id="canvasContainer" aria-label="Kartes darba lauks">
    <canvas id="mapCanvas" width="1920" height="1080"></canvas>
    <div id="resizeHandle" aria-label="Kartes izmƒìra mainƒ´≈°anas rokturis" title="Mainƒ´t izmƒìru">
      <img src="https://site-710050.mozfiles.com/files/710050/resize_map__1_.png" alt="">
    </div>
  </div>

  <!-- KOMPASSS -->
  <div id="compassContainer" aria-label="Interaktƒ´vais kompass">
    <div id="compassScaleContainer">
      <div id="compassInner">
        <img id="compassBase" src="https://site-710050.mozfiles.com/files/710050/VIRTUALAIS_KOMPASS_PAMATNE_PV6.png" alt="Kompasa pamatne">
      </div>
      <div id="compassScaleInner">
        <img id="compassScale" src="https://site-710050.mozfiles.com/files/710050/KOMPASA_SKALA_CADET_LV_PV6_V3.png" alt="Kompasa skala">
      </div>
      <img id="compassNeedle" src="https://site-710050.mozfiles.com/files/710050/VIRTUALAIS_KOMPASS_ADATA_CADET_LV_PV4.png" alt="Kompasa adata">
    </div>
  </div>

  <!-- AUG≈†ƒíJƒÄ JOSLA -->
  <div class="dropdown-container" role="navigation" aria-label="Satura izvƒìlnes">
    <div class="top-bar">
      <button class="dropdown-toggle" id="toggleInstruction" aria-expanded="false">LietotƒÅja ceƒºvedis ‚¨á</button>
      <button class="dropdown-toggle" id="toggleMaterials" aria-expanded="false">MƒÅcƒ´bu materiƒÅli ‚¨á</button>
    </div>

    <div class="dropdown-menu" id="dropdownInstruction" aria-hidden="true">
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page/">DARBAM AR DATORU</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page-1/">DARBAM AR SKƒÄRIENJ≈™Tƒ™GƒÄM IERƒ™CƒíM</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page-2/">LIETO≈†ANAS NOTEIKUMI</a>
      <iframe id="instructionFrame" title="LietotƒÅja ceƒºvedis"></iframe>
    </div>

    <div class="dropdown-menu" id="dropdownMaterials" aria-hidden="true">
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/topografiskas-kartes/">TOPOGRƒÄFISKƒÄS KARTES</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/merogs-un-attalumi/">MƒíROGS UN ATTƒÄLUMI</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/apzimejumi-kartes/">APZƒ™MƒíJUMI KARTƒíS</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/direkcijas-lenkis-un-azimuts/">DIREKCIJAS LE≈Öƒ∂IS UN AZIMUTS</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/koordinates/">KOORDINƒÄTES</a>
      <a class="dropdown-link" href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/citi/">CITI</a>
      <iframe id="contentFrame" title="MƒÅcƒ´bu materiƒÅli"></iframe>
    </div>
  </div>

  <!-- POZƒ™CIJAS IZVƒíLES PANEƒªI -->
  <div class="position-selector-shell">
    <div class="position-selector hidden" id="posRight">
      <button class="toggle-selector" type="button" aria-label="RƒÅdƒ´t / Slƒìpt">‚ùØ</button>
      <select id="positionSelect" aria-label="Pogu novietojums">
        <option disabled selected>Izvƒìlies pogas novietojumu:</option>
        <option value="bottom">Apak≈°ƒÅ (noklusƒìjums)</option>
        <option value="right">LabajƒÅ pusƒì</option>
        <option value="left">KreisajƒÅ pusƒì</option>
      </select>
    </div>
  </div>

  <div class="position-selector-shell" style="left:0; right:auto; transform:translateY(-50%)">
    <div class="position-selector-left hidden-left" id="posLeft">
      <button class="toggle-selector-left" type="button" aria-label="RƒÅdƒ´t / Slƒìpt">‚ùÆ</button>
      <select id="positionSelectLeft" aria-label="Pogu novietojums (kreisais)">
        <option disabled selected>Izvƒìlies pogas novietojumu:</option>
        <option value="bottom">Apak≈°ƒÅ (noklusƒìjums)</option>
        <option value="right">LabajƒÅ pusƒì</option>
        <option value="left">KreisajƒÅ pusƒì</option>
      </select>
    </div>
  </div>

  <!-- POGU RINDA -->
  <div class="button-container bottom" id="buttonContainer" aria-label="Rƒ´ku pogas">
    <button class="tool-btn" id="resetMap" title="Atiestatƒ´t karti (centrs/izmƒìrs)" aria-label="Atiestatƒ´t karti">
      <img src="https://site-710050.mozfiles.com/files/710050/RESER_MAPS_Cropped-Photoroom.png" alt="">
    </button>

    <button class="tool-btn" id="uploadMap" title="Aug≈°upielƒÅdƒìt karti" aria-label="Aug≈°upielƒÅdƒìt karti">
      <img src="https://site-710050.mozfiles.com/files/710050/UPLOAD_MAPS_Cropped-Photoroom.png" alt="">
    </button>

    <button class="tool-btn" id="resetCompass" title="Atiestatƒ´t kompasu" aria-label="Atiestatƒ´t kompasu">
      <img src="https://site-710050.mozfiles.com/files/710050/RESET_COMPASS_Cropped-Photoroom.png" alt="">
    </button>

    <!-- Tikai skƒÅrienam ‚Äî tiks rƒÅdƒ´tas dinamiski -->
    <button class="tool-btn" id="toggleRotationMode" title="PƒÅrslƒìgt rotƒÅcijas mƒìrƒ∑i (pamatne ‚áÑ skala)" aria-label="RotƒÅcijas mƒìrƒ∑is" style="display:none">
      <img id="toggleRotationImg" src="https://site-710050.mozfiles.com/files/710050/ROTATE_COMPASS_BASE__1__Cropped-Photoroom.png" alt="">
    </button>

    <button class="tool-btn" id="lockRotationMode" title="Bloƒ∑ƒìt rotƒÅciju" aria-label="Bloƒ∑ƒìt rotƒÅciju" style="display:none">
      <img id="lockRotationImg" src="https://site-710050.mozfiles.com/files/710050/COMPASS_ROTATE_LOCK_OPEN__1__Cropped-Photoroom.png" alt="">
    </button>

    <button class="tool-btn" id="rotateCompass90" title="ƒÄtrie 90¬∞ re≈æƒ´mi (ar slƒìg≈°anu)" aria-label="ƒÄtrie 90¬∞ re≈æƒ´mi">
      <img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_Cropped-Photoroom.png" alt="">
    </button>

    <button class="tool-btn" id="toggleFullscreen" title="PilnekrƒÅna re≈æƒ´ms" aria-label="PilnekrƒÅna re≈æƒ´ms">
      <img id="fullscreenIcon" src="https://site-710050.mozfiles.com/files/710050/fulscreen.png" alt="">
    </button>
  </div>

  <!-- APAK≈†ƒíJƒÄ JOSLA -->
  <div id="about">
    <a href="#" class="qrLink" id="shareBtn">KOPLIETOT</a>
    <span class="abouttext">CADET.LV</span>
    <span class="abouttext">INTERAKTƒ™VAIS KOMPASS</span>
    <span class="abouttext">¬© JƒÄNIS EGLIS</span>
    <a href="#" class="aboutlink" id="feedbackBtn">ATSAUKSME / ZI≈ÖOT</a>
  </div>

  <!-- ATSAUKSMES / QR -->
  <div id="iframeContainerAbout" class="fly-panel" aria-hidden="true">
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdflr72km2RpI7hdn05AmH5gRZgBk69y7UCz0sCJ37ujOyQ3Q/viewform?embedded=true" title="Atsauksmes forma"></iframe>
    <button class="fly-close" type="button" aria-label="Aizvƒìrt" data-close="#iframeContainerAbout">‚úñ</button>
  </div>

  <div id="iframeContainerQR" class="fly-panel" aria-hidden="true">
    <div id="qrCodeContent">
      <p class="qrTitle">KOPLIETO≈†ANAS QR KODS AUDITORIJAI</p>
      <img id="qrCodeImage" src="https://site-710050.mozfiles.com/files/710050/DOC_ERROR_AR_KRUSTU_PNG-1.png" alt="QR Code">
    </div>
    <button class="fly-close" type="button" aria-label="Aizvƒìrt" data-close="#iframeContainerQR">‚úñ</button>
  </div>

  <!-- ORIENTƒÄCIJA / MAZS EKRƒÄNS -->
  <div id="orientation-overlay">
    <img src="https://site-710050.mozfiles.com/files/710050/medium/Rotate_V5-2.jpg" alt="L≈´dzu, pagrieziet ierƒ´ci ainavas re≈æƒ´mƒÅ">
  </div>
  <div id="mobile-warning">
    <div>
      <p>L≈´dzu, izmantojiet lielƒÅku ekrƒÅnu ≈°ai lietotnei.</p>
      <img style="width:100px;height:auto" src="https://site-710050.mozfiles.com/files/710050/fullscreen-11-xxl.png" alt="">
      <p>INTERAKTƒ™VAIS KOMPASS</p>
      <p style="opacity:.6">CADET.LV | ¬© JƒÅnis Eglis</p>
    </div>
  </div>

<script>
(() => {
  /* ===== Util ===== */
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const clamp = (v,min,max)=>Math.min(Math.max(v,min),max);

  // Stabils viewport augstums (iOS/Android)
  const setVH = () => {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  };
  setVH();
  window.addEventListener('resize', setVH);

  const isMobileUA = () => /iphone|ipod|android.*mobile|windows phone|iemobile|opera mini/.test(navigator.userAgent.toLowerCase());
  const isSmallScreen = () => window.innerWidth < 900;

  /* ===== PilnekrƒÅna padoms ===== */
  const fullscreenMsg = $('#fullscreenMessage');
  const checkFSHint = () => {
    const w = window.innerWidth, h = window.innerHeight;
    fullscreenMsg.classList.toggle('visible', !(w >= 1024 && h >= 700) && !isMobileUA());
  };

  /* ===== MobilƒÅs ierƒ´ces brƒ´dinƒÅjumi ===== */
  const orientationOverlay = $('#orientation-overlay');
  const mobileWarning = $('#mobile-warning');

  const checkOrientation = () => {
    const isPortrait = window.matchMedia('(orientation: portrait)').matches;
    orientationOverlay.style.display = isPortrait ? 'flex' : 'none';
  };

  const updateMobileWarning = () => {
    const show = isMobileUA() && isSmallScreen();
    mobileWarning.style.display = show ? 'flex' : 'none';
  };

  window.addEventListener('resize', () => { checkFSHint(); checkOrientation(); updateMobileWarning(); });
  window.addEventListener('orientationchange', () => { checkOrientation(); });

  checkFSHint(); checkOrientation(); updateMobileWarning();

  /* ===== Touch ierƒ´ces pogas ===== */
  const touchPopup = $('#touchscreenPopup');
  const showTouchPopup = (msg, ok=true) => {
    touchPopup.textContent = msg;
    touchPopup.className = ok ? 'popup-success' : 'popup-error';
    touchPopup.style.display = 'block';
    setTimeout(()=> touchPopup.style.display='none', 4000);
  };

  let previousTouchPoints = navigator.maxTouchPoints || 0;
  const touchOnlyButtons = ['#toggleRotationMode','#lockRotationMode'].map($);
  const setTouchButtonsVisible = vis => touchOnlyButtons.forEach(b => { if(b){b.style.display = vis?'inline-flex':'none';}});

  const checkTouchscreenStatus = () => {
    const current = navigator.maxTouchPoints || 0;
    if (current > previousTouchPoints){ setTouchButtonsVisible(true); showTouchPopup('Pievienota skƒÅrienierƒ´ce. Papildu pogas pieejamas!', true); }
    else if (current < previousTouchPoints){ setTouchButtonsVisible(false); showTouchPopup('Atvienota skƒÅrienierƒ´ce. Papildu pogas paslƒìptas!', false); }
    previousTouchPoints = current;
  };
  // sƒÅkotnƒìjƒÅ pƒÅrbaude
  checkTouchscreenStatus();
  // pie notikumiem
  if (navigator.mediaDevices?.addEventListener){
    navigator.mediaDevices.addEventListener('devicechange', checkTouchscreenStatus);
  }
  window.addEventListener('pointerdown', (e)=>{ if(e.pointerType==='touch') setTouchButtonsVisible(true); });

  /* ===== PilnekrƒÅns ===== */
  const fsBtn = $('#toggleFullscreen');
  const fsIcon = $('#fullscreenIcon');
  const fsPopup = $('#fullscreenPopup');
  const fsEnterIcon = 'https://site-710050.mozfiles.com/files/710050/fulscreen.png';
  const fsExitIcon  = 'https://site-710050.mozfiles.com/files/710050/fulscreen_exit.png';

  const isFS = () => document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
  const fsMsg = ok => {
    fsPopup.textContent = ok ? 'PilnekrƒÅna re≈æƒ´ms ieslƒìgts' : 'PilnekrƒÅna re≈æƒ´ms izslƒìgts';
    fsPopup.className = ok ? 'popup-success' : 'popup-error';
    fsPopup.style.display='block';
    setTimeout(()=> fsPopup.style.display='none', 3500);
  };
  const enterFS = el => (el.requestFullscreen?.() || el.webkitRequestFullscreen?.() || el.msRequestFullscreen?.() || el.mozRequestFullScreen?.());
  const exitFS  = () => (document.exitFullscreen?.() || document.webkitExitFullscreen?.() || document.msExitFullscreen?.() || document.mozCancelFullScreen?.());

  const updateFSButton = () => {
    const active = !!isFS();
    fsIcon.src = active ? fsExitIcon : fsEnterIcon;
    fsBtn.classList.toggle('active', active);
    fsMsg(active);
  };

  fsBtn.addEventListener('click', ()=>{
    if (!isFS()) enterFS(document.documentElement); else exitFS();
  });
  document.addEventListener('fullscreenchange', updateFSButton);
  document.addEventListener('webkitfullscreenchange', updateFSButton);
  document.addEventListener('mozfullscreenchange', updateFSButton);
  document.addEventListener('MSFullscreenChange', updateFSButton);
  window.addEventListener('keydown', e => { if(e.key==='Escape' && isFS()) exitFS(); });

  /* ===== Dropdowns + Iframe ===== */
  const toggleMenu = (btn, menu, frame) => {
    const opened = menu.classList.toggle('visible');
    btn.classList.toggle('active', opened);
    btn.setAttribute('aria-expanded', String(opened));
    menu.setAttribute('aria-hidden', String(!opened));
    if(!opened && frame){
      frame.classList.remove('active');
      setTimeout(()=>{ frame.style.height='0'; frame.src=''; }, 300);
    }
  };

  const toggleInstruction = $('#toggleInstruction');
  const toggleMaterials = $('#toggleMaterials');
  const menuInstruction = $('#dropdownInstruction');
  const menuMaterials   = $('#dropdownMaterials');
  const frameInstruction= $('#instructionFrame');
  const frameContent    = $('#contentFrame');

  toggleInstruction.addEventListener('click', ()=> toggleMenu(toggleInstruction, menuInstruction, frameInstruction));
  toggleMaterials.addEventListener('click',   ()=> toggleMenu(toggleMaterials, menuMaterials, frameContent));

  // Linku ielƒÅde iframe
  $$('#dropdownInstruction .dropdown-link').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      frameInstruction.style.display='block';
      frameInstruction.classList.add('active');
      frameInstruction.src = a.href;
      // saraut pogas vizuƒÅli nav nepiecie≈°ams ‚Äì rindu saglabƒÅ
    });
  });
  $$('#dropdownMaterials .dropdown-link').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      frameContent.style.display='block';
      frameContent.classList.add('active');
      frameContent.src = a.href;
    });
  });

  // Klik≈°ƒ∑is ƒÅrpusƒì aizver
  document.addEventListener('click', (e)=>{
    if(!menuInstruction.contains(e.target) && !toggleInstruction.contains(e.target) && menuInstruction.classList.contains('visible')){
      toggleMenu(toggleInstruction,menuInstruction,frameInstruction);
    }
    if(!menuMaterials.contains(e.target) && !toggleMaterials.contains(e.target) && menuMaterials.classList.contains('visible')){
      toggleMenu(toggleMaterials,menuMaterials,frameContent);
    }
  });

  /* ===== Pogu novietojums ===== */
  const buttonContainer = $('#buttonContainer');
  const selectRight = $('#positionSelect');
  const selectLeft  = $('#positionSelectLeft');
  const syncPositionSelects = val => { selectRight.value = val; selectLeft.value = val; };
  const applyButtonsPos = val => {
    buttonContainer.classList.remove('bottom','left','right');
    buttonContainer.classList.add(val);
    localStorage.setItem('buttonPosition', val);
  };

  const closeBothPosMenus = ()=>{
    $('#posRight').classList.add('hidden');
    $('#posLeft').classList.add('hidden-left');
    $('.toggle-selector').textContent = '‚ùØ';
    $('.toggle-selector-left').textContent = '‚ùÆ';
  };

  $('.toggle-selector').addEventListener('click', ()=>{
    const panel = $('#posRight');
    if(panel.classList.contains('hidden')){ panel.classList.remove('hidden'); $('.toggle-selector').textContent='‚ùØ'; }
    else closeBothPosMenus();
  });
  $('.toggle-selector-left').addEventListener('click', ()=>{
    const panel = $('#posLeft');
    if(panel.classList.contains('hidden-left')){ panel.classList.remove('hidden-left'); $('.toggle-selector-left').textContent='‚ùÆ'; }
    else closeBothPosMenus();
  });

  [selectRight,selectLeft].forEach(sel=>{
    sel.addEventListener('change', ()=>{
      const v = sel.value;
      syncPositionSelects(v);
      applyButtonsPos(v);
      closeBothPosMenus();
    });
  });

  // Atjauno no localStorage
  const savedPos = localStorage.getItem('buttonPosition') || 'bottom';
  syncPositionSelects(savedPos); applyButtonsPos(savedPos);

  /* ===== Kanva: karte (Hi-DPI) ===== */
  const canvas = $('#mapCanvas');
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;

  const sizeCanvas = ()=>{
    const {clientWidth:w, clientHeight:h} = canvas;
    canvas.width  = Math.round(w * dpr);
    canvas.height = Math.round(h * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    redraw();
  };

  // kartes attƒìls
  const img = new Image();
  let imgX=0, imgY=0, imgW=0, imgH=0, imgScale=1;
  let dragging=false, startX=0, startY=0;
  let lastTouchDist=0;
  const resizeHandle = $('#resizeHandle');

  const adjustImageSize = ()=>{
    if(!img.naturalWidth) return;
    const cw = canvas.clientWidth, ch = canvas.clientHeight;
    const ar = img.naturalWidth / img.naturalHeight;
    const scaleFactor = .85;
    if(cw/ch > ar){ imgW = ch*ar*scaleFactor; imgH = ch*scaleFactor; }
    else { imgW = cw*scaleFactor; imgH = (cw/ar)*scaleFactor; }
    imgX = (cw - imgW)/2; imgY=(ch - imgH)/2; imgScale = 1;
    positionResizeHandle();
  };

  const redraw = ()=>{
    ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
    if(img.src) ctx.drawImage(img, imgX, imgY, imgW*imgScale, imgH*imgScale);
    if(img.src){
      ctx.lineWidth = 2; ctx.strokeStyle = 'red';
      ctx.strokeRect(imgX, imgY, imgW*imgScale, imgH*imgScale);
    }
    positionResizeHandle();
  };

  img.onload = ()=>{ adjustImageSize(); redraw(); resizeHandle.style.display='flex'; };

  // Resize handle -> stiprinƒÅm pie attƒìla lab.apak≈°ƒìjƒÅ
  const positionResizeHandle = ()=>{
    if(!img.src){ resizeHandle.style.display='none'; return; }
    const pad = window.innerWidth<=768 ? 5 : 0;
    resizeHandle.style.left = (imgX + imgW*imgScale - resizeHandle.clientWidth - pad) + 'px';
    resizeHandle.style.top  = (imgY + imgH*imgScale - resizeHandle.clientHeight - pad) + 'px';
    resizeHandle.style.display='flex';
  };

  // Reset karta
  $('#resetMap').addEventListener('click', ()=>{ adjustImageSize(); redraw(); });

  // Aug≈°upielƒÅde
  $('#uploadMap').addEventListener('click', ()=>{
    const input = document.createElement('input');
    input.type='file'; input.accept='image/*';
    input.onchange = e=>{
      const f = e.target.files[0];
      if(f){
        const r = new FileReader();
        r.onload = ev => { img.src = ev.target.result; };
        r.readAsDataURL(f);
      }
    };
    input.click();
  });

  // Drag ar peli
  canvas.addEventListener('mousedown', e=>{
    if(e.target===resizeHandle) return;
    dragging = true; startX = e.offsetX; startY = e.offsetY;
  });
  window.addEventListener('mousemove', e=>{
    if(!dragging) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left, my = e.clientY - rect.top;
    const dx = mx - startX, dy = my - startY;
    imgX += dx; imgY += dy; startX=mx; startY=my; redraw();
  });
  window.addEventListener('mouseup', ()=> dragging=false);

  // Wheel zoom (pietuvinƒÅjums zem kursora)
  canvas.addEventListener('wheel', e=>{
    e.preventDefault();
    if(!img.src) return;
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left, my = e.clientY - rect.top;
    const zoom = e.deltaY > 0 ? 0.95 : 1.05;
    const offX = mx - imgX, offY = my - imgY;
    imgX = mx - offX*zoom; imgY = my - offY*zoom; imgScale *= zoom;
    redraw();
  }, {passive:false});

  // Touch: drag + pinch
  canvas.addEventListener('touchstart', e=>{
    e.preventDefault(); if(!img.src) return;
    if(e.touches.length===1){ startX=e.touches[0].clientX; startY=e.touches[0].clientY; dragging=true; }
    else if(e.touches.length===2){ lastTouchDist = hypot(e.touches[0], e.touches[1]); }
  }, {passive:false});
  canvas.addEventListener('touchmove', e=>{
    e.preventDefault(); if(!img.src) return;
    if(e.touches.length===1 && dragging){
      const dx=e.touches[0].clientX-startX, dy=e.touches[0].clientY-startY;
      imgX+=dx; imgY+=dy; startX=e.touches[0].clientX; startY=e.touches[0].clientY; redraw();
    } else if(e.touches.length===2){
      const d = hypot(e.touches[0], e.touches[1]); const z = d/lastTouchDist; lastTouchDist = d;
      // zoom ap viduspunkta
      const cx=(e.touches[0].clientX+e.touches[1].clientX)/2;
      const cy=(e.touches[0].clientY+e.touches[1].clientY)/2;
      const rect= canvas.getBoundingClientRect(); const mx=cx-rect.left, my=cy-rect.top;
      const offX = mx - imgX, offY = my - imgY;
      imgX = mx - offX*z; imgY = my - offY*z; imgScale *= z; redraw();
    }
  }, {passive:false});
  canvas.addEventListener('touchend', ()=> dragging=false);

  function hypot(t1,t2){ const dx=t1.clientX-t2.clientX, dy=t1.clientY-t2.clientY; return Math.hypot(dx,dy); }

  // Resize rokturis (pele + touch)
  let resizing=false, rsX=0, rsY=0, startW=0, startH=0;
  const startResize = e=>{
    e.preventDefault(); resizing=true;
    const pt = ('touches' in e) ? e.touches[0] : e;
    rsX = pt.clientX; rsY = pt.clientY; startW=imgW; startH=imgH;
    window.addEventListener('mousemove', doResize, {passive:false});
    window.addEventListener('mouseup', stopResize);
    window.addEventListener('touchmove', doResize, {passive:false});
    window.addEventListener('touchend', stopResize);
  };
  const doResize = e=>{
    if(!resizing) return;
    const pt = ('touches' in e) ? e.touches[0] : e;
    const dx = pt.clientX - rsX; const dy = pt.clientY - rsY;
    imgW = Math.max(50, startW + dx); imgH = Math.max(50, startH + dy); redraw();
  };
  const stopResize = ()=>{ resizing=false; window.removeEventListener('mousemove', doResize); window.removeEventListener('mouseup', stopResize); window.removeEventListener('touchmove', doResize); window.removeEventListener('touchend', stopResize); };
  resizeHandle.addEventListener('mousedown', startResize);
  resizeHandle.addEventListener('touchstart', startResize, {passive:false});

  // SƒÅkotnƒìjƒÅ kanvas izmƒìra sinhronizƒÅcija
  sizeCanvas(); new ResizeObserver(sizeCanvas).observe(canvas);

  /* ===== Kompass (drag / pinch scale / rotate base vs scale) ===== */
  const compass = {
    container: $('#compassContainer'),
    inner:     $('#compassInner'),        // pamatne
    scaleWrap: $('#compassScaleContainer'),
    scale:     $('#compassScaleInner'),   // skala
    needle:    $('#compassNeedle')
  };
  // SƒÅkuma stƒÅvoklis
  let cLeft=550, cTop=60, cGlobal=1, cBaseRot=0, cScaleRot=70;
  const applyCompass = ()=>{
    compass.container.style.left = cLeft + 'px';
    compass.container.style.top  = cTop  + 'px';
    compass.scaleWrap.style.transform = `scale(${cGlobal})`;
    compass.inner.style.transform     = `rotate(${cBaseRot}deg)`;
    compass.scale.style.transform     = `translate(-50%,-50%) rotate(${cScaleRot}deg)`;
  };
  applyCompass();

  // Drag
  let cDragging=false, cOffX=0, cOffY=0;
  compass.container.addEventListener('mousedown', e=>{
    e.preventDefault(); cDragging=true;
    const rect=compass.container.getBoundingClientRect();
    cOffX = e.clientX - rect.left; cOffY = e.clientY - rect.top;
  });
  window.addEventListener('mousemove', e=>{
    if(!cDragging) return;
    cLeft = e.clientX - cOffX; cTop = e.clientY - cOffY; applyCompass();
  });
  window.addEventListener('mouseup', ()=> cDragging=false);

  // Touch (drag + pinch scale + rotate target)
  let tDragging=false, tStartX=0, tStartY=0, tLastDist=0, tLastAngle=0, rotationLocked=false, activeTarget='base';
  const deg = (t1,t2)=> Math.atan2(t2.clientY - t1.clientY, t2.clientX - t1.clientX) * 180/Math.PI;

  compass.container.addEventListener('touchstart', e=>{
    e.preventDefault();
    if(e.touches.length===1){
      tDragging = true; tStartX=e.touches[0].clientX; tStartY=e.touches[0].clientY;
      const rect = compass.container.getBoundingClientRect();
      cOffX = tStartX - rect.left; cOffY = tStartY - rect.top;
    }else if(e.touches.length===2){
      tLastDist = hypot(e.touches[0],e.touches[1]); tLastAngle = deg(e.touches[0],e.touches[1]);
    }
  }, {passive:false});

  compass.container.addEventListener('touchmove', e=>{
    e.preventDefault();
    if(e.touches.length===1 && tDragging){
      const cx=e.touches[0].clientX, cy=e.touches[0].clientY;
      cLeft = cx - cOffX; cTop = cy - cOffY; applyCompass();
    }else if(e.touches.length===2){
      const dist = hypot(e.touches[0],e.touches[1]);
      cGlobal = clamp(cGlobal * (dist/tLastDist), 0.5, 5); tLastDist=dist;
      if(!rotationLocked){
        const a = deg(e.touches[0],e.touches[1]); const da = a - tLastAngle;
        if(activeTarget==='base') cBaseRot += da; else cScaleRot += da;
        tLastAngle = a;
      }
      applyCompass();
    }
  }, {passive:false});
  compass.container.addEventListener('touchend', ()=> tDragging=false);

  // Wheel palƒ´dzƒ´bas re≈æƒ´mi: Shift=base rot; Alt=scale; Ctrl=skala rot
  compass.container.addEventListener('wheel', e=>{
    e.preventDefault();
    if(e.shiftKey) cBaseRot += e.deltaY * 0.005;
    else if(e.altKey){ cGlobal = clamp(cGlobal + e.deltaY * -0.0005, 0.5, 5); }
    else if(e.ctrlKey) cScaleRot += e.deltaY * 0.005;
    applyCompass();
  }, {passive:false});

  // Klaviat≈´ra
  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft') cBaseRot -= 5;
    else if(e.key==='ArrowRight') cBaseRot += 5;
    else if(e.key==='ArrowUp') cScaleRot += 5;
    else if(e.key==='ArrowDown') cScaleRot -= 5;
    applyCompass();
  });

  // Reset kompass ar animƒÅciju
  $('#resetCompass').addEventListener('click', ()=>{
    [compass.container,compass.inner,compass.scale,compass.scaleWrap].forEach(n=>n.classList.add('with-transition'));
    cLeft=550; cTop=60; cGlobal=1; cBaseRot=0; cScaleRot=70; applyCompass();
    setTimeout(()=> [compass.container,compass.inner,compass.scale,compass.scaleWrap].forEach(n=>n.classList.remove('with-transition')), 500);
  });

  // Touch tikai: mƒìrƒ∑a pƒÅrslƒìg≈°ana un lock
  const toggleRotationBtn = $('#toggleRotationMode');
  const lockRotationBtn   = $('#lockRotationMode');
  const toggleRotationImg = $('#toggleRotationImg');
  const lockRotationImg   = $('#lockRotationImg');

  if(toggleRotationBtn){
    toggleRotationBtn.addEventListener('click', ()=>{
      activeTarget = (activeTarget==='base') ? 'scale' : 'base';
      toggleRotationBtn.classList.toggle('active', activeTarget==='scale');
      toggleRotationImg.src = (activeTarget==='scale')
        ? 'https://site-710050.mozfiles.com/files/710050/SCALE_ROTATE__1__Cropped-Photoroom.png'
        : 'https://site-710050.mozfiles.com/files/710050/ROTATE_COMPASS_BASE__1__Cropped-Photoroom.png';
    });
  }
  if(lockRotationBtn){
    lockRotationBtn.addEventListener('click', ()=>{
      rotationLocked = !rotationLocked;
      lockRotationBtn.classList.toggle('active', rotationLocked);
      lockRotationImg.src = rotationLocked
        ? 'https://site-710050.mozfiles.com/files/710050/COMPASS_ROTATE_LOCK__1__Cropped-Photoroom.png'
        : 'https://site-710050.mozfiles.com/files/710050/COMPASS_ROTATE_LOCK_OPEN__1__Cropped-Photoroom.png';
    });
  }

  // ƒÄtrie 90¬∞ re≈æƒ´mi + lock
  $('#rotateCompass90').addEventListener('click', ()=>{
    // ja bija locked - atslƒìdzam
    if(rotationLocked){ rotationLocked=false; lockRotationBtn?.classList.remove('active'); return; }

    const popup = document.createElement('div');
    popup.style.position='fixed'; popup.style.inset='0'; popup.style.background='rgba(0,0,0,.55)';
    popup.style.zIndex='9998'; popup.style.display='flex'; popup.style.alignItems='center'; popup.style.justifyContent='center';

    const box = document.createElement('div');
    box.style.background='var(--glass)'; box.style.color='#fff'; box.style.padding='16px'; box.style.borderRadius='12px';
    box.style.boxShadow='var(--shadow)'; box.style.textAlign='center'; box.style.width='min(520px,92vw)';

    const title = document.createElement('p');
    title.textContent='Izvƒìlieties noteik≈°anas metodi:'; title.style.fontWeight='800';

    const row = document.createElement('div');
    row.style.display='flex'; row.style.gap='16px'; row.style.justifyContent='center';

        const mkBtn = (src, alt, handler) => {
      const b = document.createElement('button');
      b.style.margin='0'; b.style.padding='0'; b.style.cursor='pointer';
      b.style.background='transparent'; b.style.border='none';
      b.style.width='min(10vw,140px)'; b.style.height='min(10vw,140px)';
      b.style.display='flex'; b.style.alignItems='center'; b.style.justifyContent='center';
      b.style.borderRadius='14px'; b.style.transition='transform .15s ease, background .2s ease';
      b.onmouseenter = ()=> b.style.background='rgba(255,255,255,.08)';
      b.onmouseleave = ()=> b.style.background='transparent';
      b.onmousedown  = ()=> b.style.transform='scale(1.05)';
      b.onmouseup    = ()=> b.style.transform='scale(1)';
      const img = document.createElement('img');
      img.src = src; img.alt = alt; img.style.width='90%'; img.style.height='90%'; img.style.objectFit='contain';
      img.style.borderRadius='10px';
      b.appendChild(img);
      b.addEventListener('click', handler);
      return b;
    };

    const btnPos90 = mkBtn(
      'https://site-710050.mozfiles.com/files/710050/GRID_VIEW_1_1.png',
      'Rotƒìt 90¬∞',
      ()=>{
        [compass.container,compass.inner,compass.scale,compass.scaleWrap].forEach(n=>n.classList.add('with-transition'));
        cBaseRot = 90; applyCompass();
        rotationLocked = true; lockRotationBtn?.classList.add('active');
        setTimeout(()=>[compass.container,compass.inner,compass.scale,compass.scaleWrap].forEach(n=>n.classList.remove('with-transition')), 500);
        document.body.removeChild(popup);
      }
    );

    const btnNeg90 = mkBtn(
      'https://site-710050.mozfiles.com/files/710050/GRID_VIEW_2.png',
      'Rotƒìt -90¬∞',
      ()=>{
        [compass.container,compass.inner,compass.scale,compass.scaleWrap].forEach(n=>n.classList.add('with-transition'));
        cBaseRot = -90; applyCompass();
        rotationLocked = true; lockRotationBtn?.classList.add('active');
        setTimeout(()=>[compass.container,compass.inner,compass.scale,compass.scaleWrap].forEach(n=>n.classList.remove('with-transition')), 500);
        document.body.removeChild(popup);
      }
    );

    row.appendChild(btnPos90);
    row.appendChild(btnNeg90);

    box.appendChild(title);
    box.appendChild(row);
    popup.appendChild(box);
    document.body.appendChild(popup);

    // aizvƒìrt, ja klik≈°ƒ∑is ƒÅrpus kastes
    popup.addEventListener('click', (e)=>{ if(e.target===popup){ document.body.removeChild(popup); } });
  });

  /* ===== Atsauksmes / QR paneƒºi ===== */
  const togglePanel = (selector, openBottomPx = 35) => {
    const panel = document.querySelector(selector);
    const isHidden = (getComputedStyle(panel).display === 'none') || panel.style.bottom.startsWith('-');
    if(isHidden){
      panel.style.display='block';
      // nodro≈°inƒÅm CSS animƒÅcijas iespƒìju
      requestAnimationFrame(()=>{ panel.style.bottom = openBottomPx+'px'; });
    }else{
      const h = panel.getBoundingClientRect().height || 600;
      panel.style.bottom = `-${h+20}px`;
      setTimeout(()=>{ panel.style.display='none'; }, 500);
    }
  };

  // SƒÅkotnƒìji paslƒìpti un ƒÅrpus ekrƒÅna
  const initFlyPanel = (selector, hiddenOffset) => {
    const el = document.querySelector(selector);
    el.style.display='none';
    el.style.bottom = `-${hiddenOffset}px`;
  };
  initFlyPanel('#iframeContainerAbout', 640);
  initFlyPanel('#iframeContainerQR',   370);

  $('#feedbackBtn').addEventListener('click', (e)=>{ e.preventDefault(); togglePanel('#iframeContainerAbout', 35); });
  $('#shareBtn').addEventListener('click',    (e)=>{ e.preventDefault(); togglePanel('#iframeContainerQR', 35); });

  // X pogas uz abiem paneƒºiem
  $$('.fly-close').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const target = btn.getAttribute('data-close');
      if(target) togglePanel(target, 35);
    });
  });

})(); // IIFE beigas
</script>
</body>
</html>

