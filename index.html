<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>CADET.LV Interaktƒ´vais kompass ¬© JƒÅnis Eglis</title>
<link rel="icon" type="image/png" href="https://site-710050.mozfiles.com/files/710050/CADET_ICON.PNG">
<style>
  /* ========= KONSTANTES ========= */
  :root{
    --brand:#783200;           /* Tavs pamata tonis (siltƒÅ br≈´nƒÅ sƒìrija) */
    --brand-2:#bf5509;         /* hover tonis */
    --accent:#d0021b;          /* brƒ´dinƒÅjumiem */
    --bg:#181818;              /* kanvas fons */
    --panel:rgba(0,0,0,0.8);   /* tum≈°ais panelis */
    --white:#fff;
    --muted:rgba(255,255,255,0.8);
    --vh:1vh;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; margin:0; }
  body{
    background:#f0f0f0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    overflow:hidden;
  }

  /* ======= SƒÄKUMLAPAS poga ======= */
  #openInteractivebuttoncase{
    display:inline-flex; justify-content:center; align-items:center; width:100%; height:90%;
  }
  #openInteractive{
    display:flex; padding:10px 20px; background-color:var(--brand); color:#fff; border:none; border-radius:3px;
    font-size:16px; cursor:pointer; width:80%; justify-content:center; align-items:center;
  }
  #openInteractive:hover{ background-color:var(--brand-2) }

  /* =======  LOGS ========= */
  canvas{
    background-color:var(--bg);
    background-image:url('https://site-710050.mozfiles.com/files/710050/medium/CADET_TRANSP_.png?1542126381');
    background-repeat:no-repeat; background-attachment:fixed; background-size:70% 30%; background-position:center;
    z-index:1; height:100%; width:100%;
    image-rendering:crisp-edges;
    touch-action:none;
  }

  /* PilnekrƒÅna ieteikums */
  #fullscreenMessage{
    position:fixed; z-index:15; color:white; background-color:rgba(0,0,0,0.4); width:100%; height:100vh;
    display:flex; justify-content:center; align-items:center; backdrop-filter:blur(5px); visibility:visible;
  }
  #fullscreenMessage.hidden{ visibility:hidden }
  .fs-message-hidden{ display:none!important; }

  #fullscreenMessagetext{
    background-color:rgba(255,0,0,0.5); color:#fff; font-weight:700; padding:20px; width:min(60%,900px);
    text-align:center; border-radius:10px; border:2px solid red; box-sizing:border-box;
  }
  .highlight-title{ font-size:2.2vw; color:#fff; font-weight:700; display:block; margin-bottom:6px; }
  .copyright{ display:block; margin-top:8px; font-size:1.4vw; color:#fff; opacity:.85; }

  /* Uzmanƒ´bas bulta aug≈°ƒÅ (saglabƒÅta) */
  .arrow{
    border-left:2.5vh solid transparent; border-right:2.5vh solid transparent; border-bottom:5vh solid red;
    position:fixed; top:20px; right:56px; display:flex; animation:bounce 1.5s infinite ease-in-out; z-index:10;
  }
  .arrow::before{
    content:"ñßµ"; position:absolute; color:#fff; font-size:2.5vh; transform:scaleX(1.5);
    top:10px; right:-5px; z-index:11;
  }
  @keyframes bounce{
    0%{transform:translateY(0)}
    50%{transform:translateY(-15px)}
    100%{transform:translateY(0)}
  }

  /* ======= POGU KONTEINERS (apak≈°ƒÅ/kreisƒÅ/labƒÅ ‚Äì kƒÅ oriƒ£inƒÅlƒÅ) ======= */
  .button-container{
    position:fixed; z-index:2; pointer-events:none; transition:all .2s ease-in-out; gap:1vw;
    display:flex; justify-content:center; width:100%;
  }
  .button-container.bottom{ bottom:calc(var(--vh)*5) }
  .button-container.left{
    left:2%; top:50%; transform:translateY(-45%); flex-direction:column; width:auto;
  }
  .button-container.right{
    right:2%; top:50%; transform:translateY(-45%); flex-direction:column; width:auto;
  }

  button{
    background-color:rgba(91,16,16,0.8); color:#fff; border:none; border-radius:50%;
    width:6vw; height:6vw; cursor:pointer; display:flex; align-items:center; justify-content:center;
    box-shadow:0 2px 5px rgba(0,0,0,0.2); pointer-events:auto; overflow:hidden;
  }
  button img{ width:95%; height:95%; object-fit:contain; display:block; margin:auto; }
  button.active{ transform:scale(1.1) }

  /* Tikai skƒÅrienam paredzƒìtƒÅs pogas (kƒÅ pie Tevis) */
  .touch-only{ display:none }
  @media (pointer:coarse){ .touch-only{ display:flex } }

  /* Kompasa slƒÅnis (kƒÅ pie Tevis) */
  #compassContainer{ position:absolute; width:25vw; height:14vw; z-index:3; transform-origin:center; pointer-events:none; }
  #compassScaleContainer{ position:relative; width:25vw; height:14vw; transform-origin:center; pointer-events:none; }
  #compassInner{
    position:absolute; width:14vw; height:14vw; left:41.5%; top:0%;
    transform:translate(-50%,-50%) rotate(0deg); transform-origin:center;
  }
  #compassBase{
    position:absolute; width:25vw; height:auto; left:13.5%; top:50%;
    transform:translate(-49.9%,-50.2%); pointer-events:auto;
  }
  #compassScaleInner{
    position:absolute; width:14vw; height:14vw; left:41.5%; top:0%;
    transform:translate(-50%,-50%) rotate(70deg); transform-origin:center;
  }
  #compassScale{
    position:absolute; width:13vw; height:13vw; left:50.05%; top:50.04%;
    transform:translate(-50%,-50%); border-radius:50%; pointer-events:auto;
  }
  #compassNeedle{
    position:absolute; width:0.65vw; height:auto; left:69.5%; top:50%;
    transform:translate(-50%,-50%); transform-origin:center; opacity:.85; animation:rotateNeedle 50s linear infinite;
  }
  @keyframes rotateNeedle{
    from{ transform:translate(-50%,-50%) rotate(0deg) }
    to{ transform:translate(-50%,-50%) rotate(360deg) }
  }

  /* Kanvas/attƒìla ‚Äúresize‚Äù rokturis (kƒÅ pie Tevis) */
  #resizeHandle{
    display:none; align-items:center; justify-content:center;
    width:40px; height:40px; border-radius:5px; position:absolute; background-color:rgba(255,0,0,.5);
    cursor:se-resize; z-index:5;
  }
  #resizeHandle img{ width:90%; height:90%; object-fit:contain; pointer-events:none; }

  /* ======= LabƒÅs un kreisƒÅs IZVELKAMƒÄS IZVƒíLNES (saglabƒÅtas!) ======= */
  .position-selector-container{ position:fixed; top:15%; right:0; transform:translateY(-50%); z-index:3; }
  .position-selector{
    background:var(--panel); padding:10px; width:250px; display:flex; flex-direction:column; align-items:center; position:relative;
    box-shadow:0 4px 6px rgba(0,0,0,0.2);
  }
  .position-selector::after,
  .position-selector-left::after{
    content:''; display:block; height:3px; background:rgba(255,0,0,.8); position:absolute; bottom:0; left:0; right:0;
  }
  .position-selector.hidden{ transform:translateX(100%); transition:transform .3s ease-in-out; }
  .position-selector select{
    width:230px; padding:6px; border:none; border-radius:3px; font-size:16px; background:rgba(0,0,0,.5); color:#fff;
  }
  .position-selector select option{ background:rgba(0,0,0,.6); color:#fff }

  .toggle-selector{
    position:absolute; top:50%; left:-30px; transform:translateY(-50%);
    background:rgba(255,0,51,.7); color:#fff; border:none; border-radius:10px 0 0 10px; width:30px; height:100%;
    cursor:pointer; font-size:14px; text-align:center; line-height:30px;
  }
  .toggle-selector:hover{ background:rgba(255,0,0,.9) }

  .position-selector-container-left{ position:fixed; top:15%; left:0; transform:translateY(-50%); z-index:3; }
  .position-selector-left{
    background:var(--panel); padding:10px; width:250px; display:flex; flex-direction:column; align-items:center; position:relative;
    box-shadow:0 4px 6px rgba(0,0,0,0.2); transform:translateX(0); transition:transform .3s ease-in-out;
  }
  .position-selector-left.hidden-left{ transform:translateX(-100%) }
  .position-selector-left select{
    width:230px; padding:6px; border:none; border-radius:3px; font-size:16px; background:rgba(0,0,0,.5); color:#fff;
  }
  .toggle-selector-left{
    position:absolute; top:50%; right:-30px; transform:translateY(-50%);
    background:rgba(255,0,51,.7); color:#fff; border:none; border-radius:0 10px 10px 0; width:30px; height:100%;
    cursor:pointer; font-size:14px; text-align:center; line-height:30px;
  }
  .toggle-selector-left:hover{ background:rgba(255,0,0,.9) }

  /* ======= AUG≈†ƒíJƒÄ NOLAI≈ΩAMƒÄ JOSLA (LIETOTƒÄJA CEƒªVEDIS / MATERIƒÄLI) ======= */
  .dropdown-container{ position:fixed; top:0; left:0; z-index:10; width:100%; background:transparent; }
  .top-bar{
    position:fixed; top:0; left:0; width:100%; z-index:20; display:flex; justify-content:space-between; gap:10px;
    background:transparent; padding:0; transition:height .3s ease, padding .3s ease;
  }
  .dropdown-toggle{
    background:rgba(255,0,51,.7); border:none; color:#fff; padding:3px; cursor:pointer; font-size:20px;
    border-radius:0 0 5px 5px; width:49%; text-align:center; display:block; transition:background .3s, box-shadow .3s;
  }
  .dropdown-toggle:hover{ background:rgba(255,0,0,.9) }
  .dropdown-toggle.active{ box-shadow:0 0 10px rgba(255,0,51,.8) }

  .dropdown-menu{
    position:fixed; top:-100%; left:0; width:100%; height:calc(100vh - 40px);
    background:var(--panel); padding:20px; display:flex; flex-wrap:wrap; justify-content:center; align-items:center;
    box-shadow:0 4px 6px rgba(0,0,0,0.2); transition:top .4s ease, opacity .4s ease, visibility 0s .4s; visibility:hidden; opacity:0;
  }
  .dropdown-menu.visible{ top:-20px; margin-left:-18px; visibility:visible; opacity:1; transition:top .4s ease, opacity .4s ease }
  .dropdown-menu a{
    color:#fff; text-decoration:none; padding:15px 20px; font-size:20px; text-align:center; display:flex; align-items:center; justify-content:center;
    width:30%; height:50px; margin:10px; background:rgba(50,50,50,.8); border-radius:5px; transition:background .3s;
  }
  .dropdown-menu a:hover{ background:rgba(255,0,51,.7) }
  #contentFrame,#instructionFrame{
    width:100%; height:0; border:none; display:block; margin-top:0; transition:height .3s, margin-top .3s;
  }
  #contentFrame.active,#instructionFrame.active{ height:75vh; margin-top:20px; }

  .dropdown-menu.shrink a{ padding:5px 10px; font-size:14px; height:30px; margin-top:60px }
  #dropdownInstruction.shrink .dropdown-toggle{ transform:translateY(30px) }

  @media (max-width:768px){
    .top-bar{ flex-direction:column; align-items:center }
    .dropdown-toggle{ width:100%; margin-bottom:5px }
    .dropdown-menu{ flex-direction:column; height:auto; max-height:60vh; overflow-y:auto }
    .dropdown-menu a{ width:90%; font-size:18px; padding:12px }
  }

  /* Par komandu joslu apak≈°ƒÅ (saglabƒÅts) */
  #about{
    position:fixed; bottom:0; left:0; right:0; display:flex; gap:2vw; justify-content:center; padding:.3vw;
    background:var(--panel); color:var(--muted); text-align:center; z-index:20;
  }
  .abouttext{ font-size:15px; margin:1px 0 }

  .aboutlink,.qrLink{
    display:inline-block; padding:5px 10px; background:#d0021b; color:#fff; font-weight:700; text-decoration:none; border-radius:5px 5px 0 0;
    transition:all .3s ease; position:absolute; width:170px; z-index:5; text-align:center;
  }
  .aboutlink{ right:10px; top:0 }
  .qrLink{ left:10px; bottom:-2px }
  .aboutlink:hover,.qrLink:hover{ background:rgba(255,0,51,1); transform:scale(1.05) }

  /* IFRAME konteineri (saglabƒÅti) */
  #iframeContainerAbout{
    position:fixed; width:500px; height:600px; bottom:-620px; right:20px; background:#fff; box-shadow:0 4px 6px rgba(0,0,0,.1);
    border-radius:8px; overflow:hidden; transition:bottom .5s ease; display:none; z-index:9999;
  }
  #iframeContainerAbout iframe{ width:100%; height:100% }
  #closeIframeAbout{ position:absolute; top:5px; right:5px; background:red; color:#fff; border:none; width:25px; height:25px; border-radius:50%; font-size:14px; cursor:pointer }

  #iframeContainerQR{
    position:fixed; width:300px; height:330px; bottom:-370px; left:20px; background:var(--panel); box-shadow:0 4px 6px rgba(0,0,0,.1);
    border-radius:8px; overflow:hidden; transition:bottom .5s ease; display:none; z-index:20; text-align:center; padding:20px;
  }
  .qrTitle{ font-size:18px; font-weight:700; margin-bottom:10px; color:#fff }
  #qrCodeImage{ width:250px; height:250px }
  #closeIframeQR{ position:absolute; top:5px; right:5px; background:red; color:#fff; border:none; width:25px; height:25px; border-radius:50%; font-size:14px; cursor:pointer }

  /* Mobilais brƒ´dinƒÅjums & orientƒÅcija (saglabƒÅti) */
  #mobile-warning{
    position:fixed; inset:0; background:rgba(0,0,0,0.9); color:#fff; display:none; justify-content:center; align-items:center; text-align:center; font-size:1.5em; z-index:9999;
  }
  #orientation-overlay{
    display:none; position:fixed; inset:0; background:#000; color:#fff; text-align:center; z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:1.5em;
  }
  #orientation-overlay img{ width:100%; height:auto; margin-top:20px }

  /* Popupi (saglabƒÅts) */
  #touchscreenPopup,#fullscreenPopup{
    position:fixed; bottom:30px; right:10px; color:#fff; padding:15px; border-radius:5px; box-shadow:0 2px 10px rgba(0,0,0,.1);
    z-index:9999; display:none; font-weight:700; animation:slide-in .5s ease-out;
  }
  .popup-success{ background:#28a745 } .popup-error{ background:#dc3545 }
  @keyframes slide-in{ from{transform:translateX(100%)} to{transform:translateX(0)} }

</style>
</head>
<body>

<p id="openInteractivebuttoncase">
  <button id="openInteractive">Atvƒìrt Interaktƒ´vo kompasu</button>
</p>

<script>
document.getElementById('openInteractive').addEventListener('click', () => {
  const win = window.open('', '_blank', 'width=1280,height=800');
  if(!win){ alert('PƒÅrl≈´ks bloƒ∑ƒì jaunus logus. L≈´dzu, atƒºaujiet pƒÅrl≈´kam atvƒìrt logus.'); return; }

  win.document.write(`<!DOCTYPE html>
<html lang="lv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<link rel="icon" type="image/png" href="https://site-710050.mozfiles.com/files/710050/CADET_ICON.PNG">
<title>CADET.LV Interaktƒ´vais kompass ¬© JƒÅnis Eglis</title>
<style>
${document.querySelector('style').innerHTML}
</style>
</head>
<body>

<!-- Mobilais brƒ´dinƒÅjums -->
<div id="mobile-warning">
  <div class="warning-content">
    <p>L≈´dzu, izmantojiet lielƒÅku ekrƒÅnu ≈°ƒ´s lietotnes darbƒ´bai.</p>
    <img style="width:100px;height:auto" src="https://site-710050.mozfiles.com/files/710050/fullscreen-11-xxl.png" alt="Nepietiekams ekrƒÅna izmƒìrs">
    <p>INTERAKTƒ™VAIS KOMPASS</p>
    <p style="color: rgba(255,255,255,0.5)">CADET.LV | ¬© JƒÅnis Eglis</p>
  </div>
</div>

<!-- Portreta pƒÅrklƒÅjums -->
<div id="orientation-overlay">
  <h1><img src="https://site-710050.mozfiles.com/files/710050/medium/Rotate_V5-2.jpg" alt="Pagrieziet ierƒ´ci"></h1>
</div>

<!-- PilnekrƒÅna zi≈Üojums -->
<div id="fullscreenMessage" class="fs-message-hidden">
  <div class="arrow"></div>
  <p id="fullscreenMessagetext">
    <span class="highlight-title">L≈´dzu, iestatiet logu pilnƒÅ izmƒìrƒÅ, lai sƒÅktu darbu.</span>
    Varat izmantot F11, lai logu darbinƒÅtu pilnekrƒÅna re≈æƒ´mƒÅ vai palielinƒÅt logu lƒ´dz ekrƒÅna izmƒìram spie≈æot simbolu "ñßµ" pƒÅrl≈´ka galvenƒì.<br><br>
    <a href="https://cadet.lv" target="_blank" style="color:#fff;font-weight:700">CADET.LV</a><br>
    <span class="copyright">CADET.LV | ¬© JƒÅnis Eglis</span>
  </p>
</div>

<div id="touchscreenPopup"></div>
<div id="fullscreenPopup"></div>

<!-- Darba laukums (kƒÅ pie Tevis) -->
<div id="canvasContainer" style="position:fixed; width:1920px; height:1080px;">
  <canvas id="mapCanvas" width="1920" height="1080" style="display:block; width:100%; height:100%"></canvas>
  <img id="uploadedImg" src="" alt="Aug≈°upielƒÅdƒìtais attƒìls" style="position:absolute; top:0; left:0; display:none; cursor:move;">
  <div id="resizeHandle"><img src="https://site-710050.mozfiles.com/files/710050/resize_map__1_.png" alt="Resize"></div>
</div>

<!-- Papildu image (saglabƒÅts hooks) -->
<img id="newUploadedImg" style="position:absolute; top:50px; left:50px; display:none; cursor:move;" alt="Aug≈°upielƒÅdƒìtais attƒìls">
<div id="newResizeHandle" style="display:none; width:30px; height:30px; position:absolute; cursor:se-resize; z-index:9"></div>

<!-- AUG≈†ƒíJƒÄ JOSLA ar divƒÅm izvelkamƒÅm izvƒìlnƒìm (saglabƒÅtas) -->
<div class="dropdown-container">
  <div class="top-bar">
    <span class="dropdown-toggle" id="toggleInstruction">LietotƒÅja ceƒºvedis ‚¨á</span>
    <span class="dropdown-toggle" id="toggleMaterials">MƒÅcƒ´bu materiƒÅli ‚¨á</span>
  </div>

  <div class="dropdown-menu" id="dropdownInstruction">
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page/">DARBAM AR DATORU</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page-1/">DARBAM AR SKƒÄRIENJ≈™Tƒ™GƒÄM IERƒ™CƒíM</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/lietotaja-celvedis/page-2/">LIETO≈†ANAS NOTEIKUMI</a>
    <iframe id="instructionFrame" name="contentFrame"></iframe>
  </div>

  <div class="dropdown-menu" id="dropdownMaterials">
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/topografiskas-kartes/" class="dropdown-link">TOPOGRƒÄFISKƒÄS KARTES</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/merogs-un-attalumi/" class="dropdown-link">MƒíROGS UN ATTƒÄLUMI</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/apzimejumi-kartes/" class="dropdown-link">APZƒ™MƒíJUMI KARTƒíS</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/direkcijas-lenkis-un-azimuts/" class="dropdown-link">DIREKCIJAS LE≈Öƒ∂IS UN AZIMUTS</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/koordinates/" class="dropdown-link">KOORDINƒÄTES</a>
    <a href="https://cadet.mozello.lv/virtualais-kompass-macibu-materiali-un-instrukcija/macibu-materiali/citi/" class="dropdown-link">CITI</a>
    <iframe id="contentFrame" name="contentFrame"></iframe>
  </div>
</div>

<!-- SƒÄNU IZVƒíL≈ÖAS (saglabƒÅtas) -->
<div class="position-selector-container">
  <div class="position-selector hidden">
    <button class="toggle-selector">‚ùÆ</button>
    <select id="positionSelect">
      <option disabled selected>Izvƒìlies pogas novietojumu:</option>
      <option value="bottom">Apak≈°ƒÅ (noklusƒìjums)</option>
      <option value="right">LabajƒÅ pusƒì</option>
      <option value="left">KreisajƒÅ pusƒì</option>
    </select>
  </div>
</div>

<div class="position-selector-container-left">
  <div class="position-selector-left hidden-left">
    <button class="toggle-selector-left">‚ùØ</button>
    <select id="positionSelectLeft">
      <option disabled selected>Izvƒìlies pogas novietojumu:</option>
      <option value="bottom">Apak≈°ƒÅ (noklusƒìjums)</option>
      <option value="right">LabajƒÅ pusƒì</option>
      <option value="left">KreisajƒÅ pusƒì</option>
    </select>
  </div>
</div>

<!-- Re≈æƒ´mu popup (saglabƒÅts) -->
<div id="popupMenu" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); padding:10px; background:rgba(0,0,0,.8); color:#fff; border-radius:10px; text-align:center; z-index:9; width:30vw;">
  <h3>Izvƒìlieties noteik≈°anas metodi</h3>
  <div class="button-row" style="display:flex; gap:20px; justify-content:center; margin-top:10px">
    <button id="popupOption1" class="popup-button" style="background:transparent; border:none; width:10vw; height:10vw"><img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_1_1.png" alt="Funkcija 1" style="width:100%;height:100%;object-fit:contain;border-radius:10px"></button>
    <button id="popupOption2" class="popup-button" style="background:transparent; border:none; width:10vw; height:10vw"><img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_2.png" alt="Funkcija 2" style="width:100%;height:100%;object-fit:contain;border-radius:10px"></button>
  </div>
  <button id="popupClose" class="popup-close" style="margin-top:10px; background:rgba(20,20,20,.8); color:#fff; border:1px solid rgba(255,255,255,.06); border-radius:8px; padding:6px 10px; cursor:pointer">Aizvƒìrt</button>
</div>

<!-- POGU PANELIS (saglabƒÅts) -->
<div class="button-container bottom" id="buttonContainer">
  <button id="resetMap" title="Reset Map"><img src="https://site-710050.mozfiles.com/files/710050/RESER_MAPS_Cropped-Photoroom.png" alt="Reset Map"></button>
  <button id="uploadMap" title="Upload Map"><img src="https://site-710050.mozfiles.com/files/710050/UPLOAD_MAPS_Cropped-Photoroom.png" alt="Upload Map"></button>
  <button id="resetCompass" title="Reset Compass"><img src="https://site-710050.mozfiles.com/files/710050/RESET_COMPASS_Cropped-Photoroom.png" alt="Reset Compass"></button>

  <button class="touch-only" id="toggleRotationMode" title="PƒÅrslƒìgt rotƒÅciju"><img src="https://site-710050.mozfiles.com/files/710050/ROTATE_COMPASS_BASE__1__Cropped-Photoroom.png" alt="Toggle Rotation"></button>
  <button class="touch-only" id="lockRotationMode" title="Bloƒ∑ƒìt rotƒÅciju"><img src="https://site-710050.mozfiles.com/files/710050/COMPASS_ROTATE_LOCK_OPEN__1__Cropped-Photoroom.png" alt="Lock Rotation"></button>

  <button id="rotateCompass90" title="Noteik≈°anas re≈æƒ´mi"><img src="https://site-710050.mozfiles.com/files/710050/GRID_VIEW_Cropped-Photoroom.png" alt="Re≈æƒ´mi"></button>
  <button id="toggleFullscreen" title="PilnekrƒÅns"><img id="fullscreenIcon" src="https://site-710050.mozfiles.com/files/710050/fulscreen.png" alt="PilnekrƒÅns"></button>
</div>

<!-- Par joslu apak≈°ƒÅ (saglabƒÅts) -->
<div id="about">
  <a href="javascript:void(0);" class="qrLink" onclick="toggleIframeQR(event)">KOPLIETOT</a>
  <span class="abouttext">CADET.LV</span>
  <span class="abouttext">INTERAKTƒ™VAIS KOMPASS</span>
  <span class="abouttext">¬© JƒÄNIS EGLIS</span>
  <a href="javascript:void(0);" class="aboutlink" onclick="toggleIframeAbout(event)">ATSAUKSME / ZI≈ÖOT</a>
</div>

<div id="iframeContainerAbout">
  <iframe id="feedbackIframe" src="https://docs.google.com/forms/d/e/1FAIpQLSdflr72km2RpI7hdn05AmH5gRZgBk69y7UCz0sCJ37ujOyQ3Q/viewform?embedded=true" frameborder="0"></iframe>
  <button id="closeIframeAbout" onclick="toggleIframeAbout(event)">‚úñ</button>
</div>

<div id="iframeContainerQR">
  <div id="qrCodeContent">
    <p class="qrTitle">KOPLIETO≈†ANAS QR KODS AUDITORIJAI</p>
    <img id="qrCodeImage" src="https://site-710050.mozfiles.com/files/710050/DOC_ERROR_AR_KRUSTU_PNG-1.png" alt="QR Code">
  </div>
  <button id="closeIframeQR" onclick="toggleIframeQR(event)">‚úñ</button>
</div>

<!-- KOMPASS (saglabƒÅts) -->
<div id="compassContainer">
  <div id="compassScaleContainer">
    <div id="compassInner">
      <img id="compassBase" src="https://site-710050.mozfiles.com/files/710050/VIRTUALAIS_KOMPASS_PAMATNE_PV6.png" alt="Compass Base">
    </div>
    <div id="compassScaleInner">
      <img id="compassScale" src="https://site-710050.mozfiles.com/files/710050/KOMPASA_SKALA_CADET_LV_PV6_V3.png" alt="Compass Scale">
    </div>
    <img id="compassNeedle" src="https://site-710050.mozfiles.com/files/710050/VIRTUALAIS_KOMPASS_ADATA_CADET_LV_PV4.png" alt="Compass Needle">
  </div>
</div>

<script>
(function(){
  /* ======= UTIL ======= */
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  function debounce(fn, wait=50){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(null,a),wait); } }

  function updateVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight*0.01)+'px'); }
  updateVH(); window.addEventListener('resize', debounce(updateVH,50));

  /* ======= PilnekrƒÅna zi≈Üojums & logs ======= */
  function checkWindowSize(){
    const el = $('#fullscreenMessage');
    const w = window.innerWidth, h = window.innerHeight;
    if(w>=1024 && h>=700){ el.classList.add('hidden'); } else { el.classList.remove('hidden'); }
  }
  function isMobileDevice(){
    const ua = navigator.userAgent.toLowerCase();
    const isMobileUA = /iphone|ipod|android.*mobile|windows phone|iemobile|opera mini/.test(ua);
    const isSmall = window.innerWidth < 900;
    return isMobileUA || isSmall;
  }
  function showMobileWarning(){
    $('#mobile-warning').style.display = (isMobileDevice() && window.innerWidth<900) ? 'flex' : 'none';
  }
  function checkOrientation(){
    const overlay = $('#orientation-overlay');
    overlay.style.display = (window.matchMedia('(orientation: portrait)').matches) ? 'flex' : 'none';
  }
  window.addEventListener('resize', debounce(checkWindowSize,50));
  window.addEventListener('resize', debounce(showMobileWarning,50));
  window.addEventListener('resize', debounce(checkOrientation,50));
  window.addEventListener('orientationchange', checkOrientation);
  checkWindowSize(); showMobileWarning(); checkOrientation();

  /* ======= POGU NOVIETOJUMA IZVƒíLNES (abas puses saglabƒÅtas) ======= */
  const rightPanel = document.querySelector('.position-selector');
  const leftPanel  = document.querySelector('.position-selector-left');
  const rightToggle = document.querySelector('.toggle-selector');
  const leftToggle  = document.querySelector('.toggle-selector-left');
  const selectRight = $('#positionSelect');
  const selectLeft  = $('#positionSelectLeft');
  const buttonContainer = $('#buttonContainer');

  function closeBothMenus(){
    leftPanel.classList.add('hidden-left');
    rightPanel.classList.add('hidden');
    leftToggle.textContent='‚ùØ';
    rightToggle.textContent='‚ùÆ';
  }
  rightToggle.addEventListener('click', ()=>{
    if(rightPanel.classList.contains('hidden')){ rightPanel.classList.remove('hidden'); rightToggle.textContent='‚ùØ'; }
    else { closeBothMenus(); }
  });
  leftToggle.addEventListener('click', ()=>{
    if(leftPanel.classList.contains('hidden-left')){ leftPanel.classList.remove('hidden-left'); leftToggle.textContent='‚ùÆ'; }
    else { closeBothMenus(); }
  });

  function syncSelect(val){
    selectLeft.value = val; selectRight.value = val;
  }
  function applyDock(val){
    buttonContainer.classList.remove('bottom','left','right');
    buttonContainer.classList.add(val);
    localStorage.setItem('buttonPosition', val);
  }
  selectLeft.addEventListener('change', ()=>{ const v=selectLeft.value; syncSelect(v); closeBothMenus(); applyDock(v); });
  selectRight.addEventListener('change',()=>{ const v=selectRight.value; syncSelect(v); closeBothMenus(); applyDock(v); });

  // Atjauno no localStorage
  const savedDock = localStorage.getItem('buttonPosition') || 'bottom';
  applyDock(savedDock); syncSelect(savedDock);

  /* ======= AUG≈†ƒíJƒÄ DROPDOWN LOƒ¢IKA (saglabƒÅta) ======= */
  $('#toggleMaterials').addEventListener('click', ()=>{
    const menu = $('#dropdownMaterials'); const btn = $('#toggleMaterials');
    menu.classList.toggle('visible'); btn.classList.toggle('active');
    if(!menu.classList.contains('visible')){
      const iframe = $('#contentFrame'); iframe.classList.remove('active');
      setTimeout(()=>{ iframe.style.display='none'; iframe.src=''; },300);
      menu.classList.remove('shrink');
    }
  });
  $('#toggleInstruction').addEventListener('click', ()=>{
    const menu = $('#dropdownInstruction'); const btn = $('#toggleInstruction');
    menu.classList.toggle('visible'); btn.classList.toggle('active');
    if(!menu.classList.contains('visible')){
      const iframe = $('#instructionFrame'); iframe.classList.remove('active');
      setTimeout(()=>{ iframe.style.display='none'; iframe.src=''; },300);
      menu.classList.remove('shrink');
    }
  });

  // Atver saites materiƒÅliem Instruction/Materials
  document.querySelectorAll('#dropdownMaterials a').forEach(a=>{
    a.addEventListener('click',(e)=>{
      e.preventDefault();
      const iframe = $('#contentFrame'); const menus = $$('.dropdown-menu');
      iframe.style.display='block'; iframe.classList.add('active'); iframe.src = a.getAttribute('href');
      menus.forEach(m=>m.classList.add('shrink'));
    });
  });
  document.querySelectorAll('#dropdownInstruction a').forEach(a=>{
    a.addEventListener('click',(e)=>{
      e.preventDefault();
      const iframe = $('#instructionFrame'); const menu = $('#dropdownInstruction');
      iframe.style.display='block'; iframe.classList.add('active'); iframe.src = a.getAttribute('href');
      menu.classList.add('shrink');
    });
  });

  // Aizvƒìr≈°ana uz ƒÅrƒìja klik≈°ƒ∑a
  document.addEventListener('click', (e)=>{
    const m1 = $('#dropdownInstruction'), b1 = $('#toggleInstruction');
    const m2 = $('#dropdownMaterials'),  b2 = $('#toggleMaterials');
    if(!m1.contains(e.target) && !b1.contains(e.target)){ m1.classList.remove('visible'); b1.classList.remove('active'); }
    if(!m2.contains(e.target) && !b2.contains(e.target)){ m2.classList.remove('visible'); b2.classList.remove('active'); }
  });

  /* ======= PILNEKRƒÄNS ======= */
  const fullscreenIcon = $('#fullscreenIcon');
  function isFS(){ return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement; }
  function enterFS(){ const el=document.documentElement; (el.requestFullscreen||el.webkitRequestFullscreen||el.mozRequestFullScreen||el.msRequestFullscreen)?.call(el); }
  function exitFS(){ (document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen)?.call(document); }
  function setFSIcon(){ fullscreenIcon.src = isFS()
      ? 'https://site-710050.mozfiles.com/files/710050/fulscreen_exit.png'
      : 'https://site-710050.mozfiles.com/files/710050/fulscreen.png'; }
  $('#toggleFullscreen').addEventListener('click', ()=>{ isFS()?exitFS():enterFS(); });
  ['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange','visibilitychange']
    .forEach(ev=>document.addEventListener(ev, ()=>{ setFSIcon(); showFullscreenPopup(isFS()); }));

  function showFullscreenPopup(on){
    const el = $('#fullscreenPopup'); el.textContent = on ? 'PilnekrƒÅna re≈æƒ´ms ieslƒìgts' : 'PilnekrƒÅna re≈æƒ´ms izslƒìgts';
    el.className = on ? 'popup-success' : 'popup-error'; el.style.display='block'; setTimeout(()=> el.style.display='none', 4000);
  }
  setFSIcon();

  /* ======= TOUCH ierƒ´ces detekcija (saglabƒÅts) ======= */
  (function(){
    let prevPoints = navigator.maxTouchPoints;
    const pop = $('#touchscreenPopup');
    function show(msg, ok=true){ pop.textContent=msg; pop.className = ok?'popup-success':'popup-error'; pop.style.display='block'; setTimeout(()=> pop.style.display='none', 5000) }
    function showTouchBtns(vis){
      $$('.touch-only').forEach(el=>{ el.style.display = vis ? 'inline-flex' : 'none'; });
    }
    function check(){
      const now = navigator.maxTouchPoints;
      if(now>prevPoints){ show('Pievienota skƒÅrienierƒ´ce. Papildu pogas!', true); showTouchBtns(true); }
      else if(now<prevPoints){ show('SkƒÅrienierƒ´ce atvienota. Pogas paslƒìptas!', false); showTouchBtns(false); }
      prevPoints = now;
    }
    setInterval(check, 1000);
    window.addEventListener('pointerdown', e=>{ if(e.pointerType==='touch'){ showTouchBtns(true) } });
  })();

  /* ======= KARTES Zƒ™Mƒí≈†ANA ======= */
  const canvas = $('#mapCanvas');
  const ctx = canvas.getContext('2d');
  const img = new Image();
  let imgX=0, imgY=0, imgW=0, imgH=0, imgScale=1;
  let dragging=false, startX=0, startY=0;
  let lastTouchDistance=0;
  let resizing=false, startW=0, startH=0, startClientX=0, startClientY=0;
  const resizeHandle = $('#resizeHandle');

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(imgW>0 && imgH>0){
      ctx.drawImage(img, imgX, imgY, imgW*imgScale, imgH*imgScale);
      ctx.lineWidth=2; ctx.strokeStyle='red'; ctx.strokeRect(imgX,imgY,imgW*imgScale,imgH*imgScale);
      positionResizeHandle();
    }
  }
  function fit(){
    if(!img.naturalWidth) return;
    const aspect = img.naturalWidth/img.naturalHeight, k=.85;
    if(canvas.width/canvas.height > aspect){ imgW = canvas.height*aspect*k; imgH = canvas.height*k; }
    else{ imgW = canvas.width*k; imgH = (canvas.width/aspect)*k; }
    imgX=(canvas.width-imgW)/2; imgY=(canvas.height-imgH)/2; imgScale=1;
  }
  function positionResizeHandle(){
    if(!(imgW>0 && imgH>0)){ resizeHandle.style.display='none'; return; }
    resizeHandle.style.display='flex';
    const off = (window.innerWidth<=768)?5:0;
    resizeHandle.style.left = (imgX + imgW*imgScale - resizeHandle.clientWidth - off) + 'px';
    resizeHandle.style.top  = (imgY + imgH*imgScale - resizeHandle.clientHeight - off) + 'px';
  }
  function getDist(t1,t2){ const dx=t1.clientX-t2.clientX, dy=t1.clientY-t2.clientY; return Math.hypot(dx,dy); }

  // Reset
  $('#resetMap').addEventListener('click', ()=>{ fit(); draw(); });

  // Aug≈°upielƒÅde
  $('#uploadMap').addEventListener('click', ()=>{
    const fi = document.createElement('input'); fi.type='file'; fi.accept='image/*';
    fi.addEventListener('change', e=>{
      const f=e.target.files?.[0]; if(!f) return;
      const rd=new FileReader(); rd.onload=ev=>{ img.src = ev.target.result; }; rd.readAsDataURL(f);
    });
    fi.click();
  });

  // Drag&Drop
  canvas.addEventListener('dragover', e=>e.preventDefault());
  canvas.addEventListener('drop', e=>{
    e.preventDefault();
    const f=e.dataTransfer.files?.[0]; if(!f) return;
    const rd=new FileReader(); rd.onload=ev=>{ img.src = ev.target.result; }; rd.readAsDataURL(f);
  });

  // Kad attƒìls ielƒÅdƒìts
  img.onload = ()=>{ fit(); draw(); };

  // Pele drag vai roktura resize
  canvas.addEventListener('mousedown', (e)=>{
    const rh = resizeHandle.getBoundingClientRect();
    if(e.clientX>=rh.left && e.clientX<=rh.right && e.clientY>=rh.top && e.clientY<=rh.bottom){
      resizing=true; startW=imgW; startH=imgH; startClientX=e.clientX; startClientY=e.clientY; return;
    }
    startX = e.offsetX; startY = e.offsetY; dragging=true;
  });
  window.addEventListener('mousemove', (e)=>{
    if(resizing){
      const dx=e.clientX-startClientX, dy=e.clientY-startClientY;
      imgW=Math.max(50, startW+dx); imgH=Math.max(50, startH+dy); draw(); return;
    }
    if(!dragging) return;
    const dx=e.offsetX-startX, dy=e.offsetY-startY; imgX+=dx; imgY+=dy; startX=e.offsetX; startY=e.offsetY; draw();
  });
  window.addEventListener('mouseup', ()=>{ dragging=false; resizing=false; });

  // Zoom ar riteni ap kursora punktu
  canvas.addEventListener('wheel', (e)=>{
    e.preventDefault();
    if(!(imgW>0 && imgH>0)) return;
    const zoom = e.deltaY>0 ? .95 : 1.05;
    const rect = canvas.getBoundingClientRect();
    const mx=e.clientX-rect.left, my=e.clientY-rect.top;
    const ox=mx-imgX, oy=my-imgY;
    imgX = mx - ox*zoom; imgY = my - oy*zoom; imgScale*=zoom; draw();
  }, { passive:false });

  // Touch: pƒÅrvieto≈°ana + pinch zoom
  canvas.addEventListener('touchstart', (e)=>{
    e.preventDefault();
    if(e.touches.length===1){
      const t=e.touches[0], rect=canvas.getBoundingClientRect();
      startX=t.clientX-rect.left; startY=t.clientY-rect.top; dragging=true;
    } else if(e.touches.length===2){
      lastTouchDistance = getDist(e.touches[0], e.touches[1]);
    }
  }, { passive:false });
  canvas.addEventListener('touchmove', (e)=>{
    e.preventDefault();
    const rect=canvas.getBoundingClientRect();
    if(e.touches.length===1 && dragging){
      const t=e.touches[0], x=t.clientX-rect.left, y=t.clientY-rect.top;
      const dx=x-startX, dy=y-startY; imgX+=dx; imgY+=dy; startX=x; startY=y; draw();
    }else if(e.touches.length===2){
      const d=getDist(e.touches[0], e.touches[1]); const zoom=d/(lastTouchDistance||d); lastTouchDistance=d;
      const cx=(e.touches[0].clientX+e.touches[1].clientX)/2 - rect.left;
      const cy=(e.touches[0].clientY+e.touches[1].clientY)/2 - rect.top;
      const ox=cx-imgX, oy=cy-imgY; imgX=cx-ox*zoom; imgY=cy-oy*zoom; imgScale*=zoom; draw();
    }
  }, { passive:false });
  canvas.addEventListener('touchend', ()=>{ dragging=false; });

  /* ======= KOMPASS ======= */
  const compassContainer = $('#compassContainer');
  const compassScaleContainer = $('#compassScaleContainer');
  const compassInner = $('#compassInner');
  const compassScaleInner = $('#compassScaleInner');
  const lockRotationModeButton = $('#lockRotationMode');
  const toggleRotationModeButton = $('#toggleRotationMode');

  let compassLeft=550, compassTop=60, globalScale=1, baseRotation=0, scaleRotation=70;
  let activeRotationTarget='compassInner', isRotationLocked=false;

  function updateCompass(){
    compassContainer.style.left=compassLeft+'px';
    compassContainer.style.top =compassTop +'px';
    compassScaleContainer.style.transform='scale('+globalScale+')';
    compassInner.style.transform='rotate('+baseRotation+'deg)';
    compassScaleInner.style.transform='rotate('+scaleRotation+'deg)';
  }
  updateCompass();

  // Drag kompass ar peli
  let compDrag=false, compDX=0, compDY=0;
  compassContainer.addEventListener('mousedown', (e)=>{
    e.preventDefault(); compDrag=true;
    const r=compassContainer.getBoundingClientRect();
    compDX=e.clientX-r.left; compDY=e.clientY-r.top;
  });
  window.addEventListener('mousemove', (e)=>{ if(!compDrag) return; compassLeft=e.clientX-compDX; compassTop=e.clientY-compDY; updateCompass(); });
  window.addEventListener('mouseup', ()=> compDrag=false);

  // Touch kompass: drag + pinch scale + rotƒÅcija
  let lastD=0, lastAng=0;
  function ang(a,b){ const dx=b.clientX-a.clientX, dy=b.clientY-a.clientY; return Math.atan2(dy,dx)*180/Math.PI; }
  compassContainer.addEventListener('touchstart', (e)=>{
    e.preventDefault();
    if(e.touches.length===1){
      const r=compassContainer.getBoundingClientRect();
      compDX=e.touches[0].clientX-r.left; compDY=e.touches[0].clientY-r.top;
    }else if(e.touches.length===2){ lastD=getDist(e.touches[0],e.touches[1]); lastAng=ang(e.touches[0],e.touches[1]); }
  }, { passive:false });
  compassContainer.addEventListener('touchmove', (e)=>{
    e.preventDefault();
    if(e.touches.length===1){
      compassLeft = e.touches[0].clientX - compDX;
      compassTop  = e.touches[0].clientY - compDY;
      updateCompass();
    }else if(e.touches.length===2){
      const d=getDist(e.touches[0],e.touches[1]); globalScale *= d/(lastD||d); lastD=d;
      if(!isRotationLocked){
        const a=ang(e.touches[0],e.touches[1]);
        if(activeRotationTarget==='compassInner'){ baseRotation += a-lastAng; }
        else{ scaleRotation += a-lastAng; }
        lastAng=a;
      }
      updateCompass();
    }
  }, { passive:false });

  // Ritenis virs kompasa (modifikatori)
  compassContainer.addEventListener('wheel', (e)=>{
    e.preventDefault();
    if(e.shiftKey){ baseRotation += e.deltaY*0.005; }
    else if(e.altKey){ globalScale += e.deltaY*-0.0005; globalScale=Math.min(Math.max(.5,globalScale),5); }
    else if(e.ctrlKey){ scaleRotation += e.deltaY*0.005; }
    updateCompass();
  }, { passive:false });

  // Tastat≈´ra ‚Äì bulti≈Üas
  document.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowLeft'){ baseRotation-=5; updateCompass(); }
    if(e.key==='ArrowRight'){ baseRotation+=5; updateCompass(); }
    if(e.key==='ArrowUp'){ scaleRotation+=5; updateCompass(); }
    if(e.key==='ArrowDown'){ scaleRotation-=5; updateCompass(); }
  });

  // Reset kompass
  $('#resetCompass').addEventListener('click', ()=>{
    compassLeft=550; compassTop=60; globalScale=1; baseRotation=0; scaleRotation=70; updateCompass();
  });

  // SkƒÅrienam paredzƒìtie slƒìd≈æi
  toggleRotationModeButton?.addEventListener('click', ()=>{
    activeRotationTarget = (activeRotationTarget==='compassInner') ? 'compassScaleInner' : 'compassInner';
    toggleRotationModeButton.style.background = (activeRotationTarget==='compassInner') ? 'rgba(91,16,16,0.8)' : 'rgb(187, 1, 1)';
  });
  lockRotationModeButton?.addEventListener('click', ()=>{
    isRotationLocked=!isRotationLocked; lockRotationModeButton.classList.toggle('active', isRotationLocked);
  });

  // Re≈æƒ´mu popup (saglabƒÅts)
  const popup = $('#popupMenu');
  $('#rotateCompass90').addEventListener('click', ()=>{
    popup.style.display='block';
  });
  $('#popupClose').addEventListener('click', ()=>{ popup.style.display='none' });
  $('#popupOption1').addEventListener('click', ()=>{ popup.style.display='none' });
  $('#popupOption2').addEventListener('click', ()=>{ popup.style.display='none' });

  /* ======= IFRAME paneƒºi apak≈°ƒÅ (saglabƒÅti) ======= */
  window.toggleIframeAbout = function(ev){
    if(ev) ev.preventDefault();
    const box = $('#iframeContainerAbout');
    const cs = getComputedStyle(box);
    if(cs.display==='none' || cs.bottom==='-620px'){
      box.style.display='block'; setTimeout(()=> box.style.bottom='35px', 10);
    }else{
      box.style.bottom='-620px'; setTimeout(()=> box.style.display='none', 500);
    }
  }
  window.toggleIframeQR = function(ev){
    if(ev) ev.preventDefault();
    const box = $('#iframeContainerQR');
    const cs = getComputedStyle(box);
    if(cs.display==='none' || cs.bottom==='-370px'){
      box.style.display='block'; setTimeout(()=> box.style.bottom='35px', 10);
    }else{
      box.style.bottom='-370px'; setTimeout(()=> box.style.display='none', 500);
    }
  }
  // SƒÅkuma stƒÅvoklis
  (function initIframeStates(){
    const a = $('#iframeContainerAbout'); a.style.display='none'; a.style.bottom='-620px';
    const q = $('#iframeContainerQR'); q.style.display='none'; q.style.bottom='-370px';
  })();
})();
</script>



</body>
</html>
